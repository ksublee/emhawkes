<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extended example : emhawkes package • emhawkes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extended example : emhawkes package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">emhawkes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example.html">Example : emhawkes package</a></li>
    <li><a class="dropdown-item" href="../articles/extended_example.html">Extended example : emhawkes package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ksublee/emhawkes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extended example : emhawkes package</h1>
                        <h4 data-toc-skip class="author">Kyungsub
Lee</h4>
            
            <h4 data-toc-skip class="date">2025-08-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ksublee/emhawkes/blob/master/vignettes/extended_example.Rmd" class="external-link"><code>vignettes/extended_example.Rmd</code></a></small>
      <div class="d-none name"><code>extended_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="basic-hawkes-model">Basic Hawkes model<a class="anchor" aria-label="anchor" href="#basic-hawkes-model"></a>
</h2>
<div class="section level3">
<h3 id="univariate-hawkes-process">Univariate Hawkes process<a class="anchor" aria-label="anchor" href="#univariate-hawkes-process"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ksublee/emhawkes" class="external-link">emhawkes</a></span><span class="op">)</span></span></code></pre></div>
<p>This subsection outlines the steps for constructing, running
simulations, and estimating a univariate Hawkes model. To begin, create
an <code>hspec</code> object, which defines the Hawkes model. The S4
class <code>hspec</code> contains slots for the model parameters:
<code>mu</code>, <code>alpha</code>, <code>beta</code>,
<code>dimens</code>, <code>rmark</code>, and <code>impact</code>.</p>
<p>In a univariate model, the basic parameters of the
model—<code>mu</code>, <code>alpha</code>, and <code>beta</code>—can be
given as numeric values. If numeric values are provided, they will be
converted to matrices. Below is an example of a univariate Hawkes model
without a mark.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>; <span class="va">alpha1</span> <span class="op">&lt;-</span> <span class="fl">1.2</span>; <span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">hspec1</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="va">mu1</span>, alpha <span class="op">=</span> <span class="va">alpha1</span>, beta <span class="op">=</span> <span class="va">beta1</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">hspec1</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 1-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  1.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  1.5</span></span></code></pre></div>
<p>The function <code>hsim</code> implements simulation where the input
arguments are <code>hspec</code>, <code>size</code>, and the initial
values of the intensity component process,
<code>lambda_component0</code>, and the initial values of the Hawkes
processes, <code>N0</code>. More precisely, the intensity process of the
basic univariate Hawkes model is represented by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>μ</mi><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><mi>α</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>d</mi><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>μ</mi><mo>+</mo><msub><mi>λ</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mi>t</mi></mrow></msup><mo>+</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mi>α</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>d</mi><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\lambda(t) = \mu + \int_{-\infty}^t \alpha e^{-\beta (t-s)} d N(s) = \mu + \lambda_c(0) e^{-\beta t} + \int_0^t \alpha e^{-\beta (t-s)} d N(s)
</annotation></semantics></math></p>
<p>where the <code>lambda_component0</code> denotes</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>c</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mn>0</mn></msubsup><mi>α</mi><msup><mi>e</mi><mrow><mi>β</mi><mi>s</mi></mrow></msup><mi>d</mi><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\lambda_c(0) = \int_{-\infty}^0 \alpha e^{\beta s} d N(s).
</annotation></semantics></math></p>
<p>If <code>lambda_component0</code> is not provided, the internally
determined initial values for the intensity process are used. If
<code>size</code> is sufficiently large, the exact value of
<code>lambda_component0</code> may not be important. The default initial
value of the counting process, <code>N0</code>, is zero.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec1</span>, size <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;        arrival N1 mark lambda1</span></span>
<span><span class="co">#&gt;  [1,]  0.00000  0    0 0.90000</span></span>
<span><span class="co">#&gt;  [2,]  0.97794  1    1 0.43838</span></span>
<span><span class="co">#&gt;  [3,]  1.09001  2    1 1.43128</span></span>
<span><span class="co">#&gt;  [4,]  1.28999  3    1 2.02711</span></span>
<span><span class="co">#&gt;  [5,]  1.53225  4    1 2.33527</span></span>
<span><span class="co">#&gt;  [6,]  1.65001  5    1 3.01139</span></span>
<span><span class="co">#&gt;  [7,]  2.51807  6    1 1.36377</span></span>
<span><span class="co">#&gt;  [8,]  2.81710  7    1 1.74553</span></span>
<span><span class="co">#&gt;  [9,]  2.87547  8    1 2.72378</span></span>
<span><span class="co">#&gt; [10,]  3.16415  9    1 2.65016</span></span>
<span><span class="co">#&gt; [11,]  3.51378 10    1 2.40131</span></span>
<span><span class="co">#&gt; [12,]  4.22355 11    1 1.43843</span></span>
<span><span class="co">#&gt; [13,] 16.96752 12    1 0.30000</span></span>
<span><span class="co">#&gt; [14,] 17.71654 13    1 0.69015</span></span>
<span><span class="co">#&gt; [15,] 19.10293 14    1 0.49874</span></span>
<span><span class="co">#&gt; [16,] 24.06354 15    1 0.30082</span></span>
<span><span class="co">#&gt; [17,] 24.09256 16    1 1.44967</span></span>
<span><span class="co">#&gt; [18,] 28.40173 17    1 0.30366</span></span>
<span><span class="co">#&gt; [19,] 28.53743 18    1 1.28198</span></span>
<span><span class="co">#&gt; [20,] 28.56702 19    1 2.38725</span></span>
<span><span class="co">#&gt; ... with 980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<p>The results of <code>hsim</code> is an S3 class <code>hreal</code>,
which consists of <code>hspec</code>, <code>inter_arrival</code>,
<code>arrival</code>, <code>type</code>, <code>mark</code>,
<code>N</code>, <code>Nc</code>, <code>lambda</code>,
<code>lambda_component</code>, <code>rambda</code>,
<code>rambda_component</code>.</p>
<ul>
<li><p><code>hspec</code> is the model specification.</p></li>
<li><p><code>inter_arrival</code> is the inter-arrival time of every
event.</p></li>
<li><p><code>arrival</code> is the cumulative sum of
<code>inter_arrival</code>.</p></li>
<li><p><code>type</code> is the type of events, i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>i</mi></msub><annotation encoding="application/x-tex">N_i</annotation></semantics></math>,
and is used for a multivariate model.</p></li>
<li><p><code>mark</code> is a numeric vector that represents additional
information for the event.</p></li>
<li><p><code>lambda</code> represents
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,
which is the left continuous and right limit version.</p></li>
<li><p>The right continuous version of intensity is
<code>rambda</code>.</p></li>
<li><p><code>lambda_component</code> represents
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{ij}</annotation></semantics></math>,
and <code>rambda_component</code> is the right continuous
version.</p></li>
</ul>
<p><code>inter_arrival</code>, <code>type</code>, <code>mark</code>,
<code>N</code>, and <code>Nc</code> start at zero. Using the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function, one can print the first 20 elements of
<code>arrival</code>, <code>N</code>, and <code>lambda</code>. The
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function can also be used.</p>
<p>By definition, we have
<code>lambda == mu + lambda_component</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first and third columns are the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">res1</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">res1</span><span class="op">$</span><span class="va">lambda_component</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">mu1</span> <span class="op">+</span> <span class="va">res1</span><span class="op">$</span><span class="va">lambda_component</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]     [,2]     [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.900000 0.600000 0.900000</span></span>
<span><span class="co">#&gt; [2,] 0.438383 0.138383 0.438383</span></span>
<span><span class="co">#&gt; [3,] 1.431282 1.131282 1.431282</span></span>
<span><span class="co">#&gt; [4,] 2.027111 1.727111 2.027111</span></span>
<span><span class="co">#&gt; [5,] 2.335269 2.035269 2.335269</span></span></code></pre></div>
<p>For all rows except the first, <code>rambda</code> equals
<code>lambda + alpha</code> in this model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># second and third columns are the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">res1</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">res1</span><span class="op">$</span><span class="va">rambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">res1</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">+</span> <span class="va">alpha1</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]     [,2]     [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.900000 0.900000 2.100000</span></span>
<span><span class="co">#&gt; [2,] 0.438383 1.638383 1.638383</span></span>
<span><span class="co">#&gt; [3,] 1.431282 2.631282 2.631282</span></span>
<span><span class="co">#&gt; [4,] 2.027111 3.227111 3.227111</span></span>
<span><span class="co">#&gt; [5,] 2.335269 3.535269 3.535269</span></span></code></pre></div>
<p>Additionally, verify that the exponential decay is accurately
represented in the model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By definition, the following two are equal:</span></span>
<span><span class="va">res1</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.438383 1.431282 2.027111 2.335269 3.011391</span></span>
<span><span class="va">mu1</span> <span class="op">+</span> <span class="op">(</span><span class="va">res1</span><span class="op">$</span><span class="va">rambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">-</span> <span class="va">mu1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta1</span> <span class="op">*</span> <span class="va">res1</span><span class="op">$</span><span class="va">inter_arrival</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.438383 1.431282 2.027111 2.335269 3.011391</span></span></code></pre></div>
<p>The log-likelihood function is calculated using the
<code>logLik</code> method. In this context, the inter-arrival times and
<code>hspec</code> are provided as inputs to the function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hspec1</span>, inter_arrival <span class="op">=</span> <span class="va">res1</span><span class="op">$</span><span class="va">inter_arrival</span><span class="op">)</span></span>
<span><span class="co">#&gt; The initial values for intensity processes are not provided. Internally determined initial values are used.</span></span>
<span><span class="co">#&gt; loglikelihood </span></span>
<span><span class="co">#&gt;     -214.2385</span></span></code></pre></div>
<p>The likelihood estimation is performed using the <code>hfit</code>
function. The specification of the initial parameter values,
<code>hspec0</code>, is required. Note that only
<code>inter_arrival</code> is needed for this univariate model. For more
accurate simulation, it is recommended to specify <code>lambda0</code>,
the initial value of the lambda component. If <code>lambda0</code> is
not provided, the function uses internally determined initial values. By
default, the BFGS method is employed for numerical optimization.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initial value for numerical optimization</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>; <span class="va">alpha0</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>; <span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fl">1.8</span></span>
<span><span class="va">hspec0</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="va">mu0</span>, alpha <span class="op">=</span> <span class="va">alpha0</span>, beta <span class="op">=</span> <span class="va">beta0</span><span class="op">)</span></span>
<span><span class="co"># the intial values are provided through hspec</span></span>
<span><span class="va">mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec0</span>, inter_arrival <span class="op">=</span> <span class="va">res1</span><span class="op">$</span><span class="va">inter_arrival</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 24 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -213.4658 </span></span>
<span><span class="co">#&gt; 3  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;        Estimate Std. error t value Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1     0.33641    0.03475   9.682  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1  1.16654    0.09608  12.141  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; beta1   1.52270    0.12468  12.213  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bivariate-hawkes-model">Bivariate Hawkes model<a class="anchor" aria-label="anchor" href="#bivariate-hawkes-model"></a>
</h3>
<p>The intensity process of a basic bivariate Hawkes model is defined
by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>μ</mi><mn>1</mn></msub><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><msub><mi>α</mi><mn>11</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>11</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>d</mi><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><msub><mi>α</mi><mn>12</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>12</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>d</mi><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
 \lambda_1(t) = \mu_1 + \int_{-\infty}^t \alpha_{11} e^{-\beta_{11}(t-s)} d N_1(s) + \int_{-\infty}^t \alpha_{12} e^{-\beta_{12}(t-s)} d N_2(s),
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>μ</mi><mn>2</mn></msub><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><msub><mi>α</mi><mn>21</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>21</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>d</mi><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><msub><mi>α</mi><mn>22</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>22</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>d</mi><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
 \lambda_2(t) = \mu_2 + \int_{-\infty}^t \alpha_{21} e^{-\beta_{21}(t-s)} d N_1(s) + \int_{-\infty}^t \alpha_{22} e^{-\beta_{22}(t-s)} d N_2(s).
</annotation></semantics></math></p>
<p>In a bivariate model, the parameters within the slots of
<code>hspec</code> are matrices. Specifically, <code>mu</code> is a
2-by-1 matrix, while <code>alpha</code> and <code>beta</code> are 2-by-2
matrices.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>2</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>α</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>12</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>21</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>22</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>β</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>12</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>21</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>22</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\mu = \begin{bmatrix} \mu_1 \\ \mu_2 \end{bmatrix}, \quad
\alpha = \begin{bmatrix} \alpha_{11} &amp; \alpha_{12} \\ \alpha_{21} &amp; \alpha_{22} \end{bmatrix}, \quad
\beta = 
\begin{bmatrix} \beta_{11} &amp; \beta_{12} \\ \beta_{21} &amp; \beta_{22} \end{bmatrix}
</annotation></semantics></math></p>
<p><code>rmark</code> is a random number generating function for marks
and is not used in non-mark models. <code>lambda_component0</code> is a
2-by-2 matrix that represents the initial values of
<code>lambda_component</code>, which includes the set of values
<code>lambda11</code>, <code>lambda12</code>, <code>lambda21</code>, and
<code>lambda22</code>. The intensity processes are represented by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>μ</mi><mn>1</mn></msub><mo>+</mo><msub><mi>λ</mi><mn>11</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>λ</mi><mn>12</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex"> \lambda_1(t) = \mu_1 + \lambda_{11}(t) + \lambda_{12}(t), </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>μ</mi><mn>2</mn></msub><mo>+</mo><msub><mi>λ</mi><mn>21</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>λ</mi><mn>22</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex"> \lambda_2(t) = \mu_2 + \lambda_{21}(t) + \lambda_{22}(t). </annotation></semantics></math></p>
<p>The terms
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{ij}</annotation></semantics></math>
are referred to as lambda components, and <code>lambda0</code>
represents $_{ij}(0)<code>.  The parameter</code>lambda_component0` can
be omitted in this model, in which case internally determined initial
values will be used.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.25</span>, <span class="fl">2.25</span>, <span class="fl">2.25</span>, <span class="fl">2.25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hspec2</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu2</span>, alpha<span class="op">=</span><span class="va">alpha2</span>, beta<span class="op">=</span><span class="va">beta2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hspec2</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  0.2</span></span>
<span><span class="co">#&gt; [2,]  0.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.5  0.9</span></span>
<span><span class="co">#&gt; [2,]  0.9  0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 2.25 2.25</span></span>
<span><span class="co">#&gt; [2,] 2.25 2.25</span></span></code></pre></div>
<p>To perform a simulation, use the <code>hsim</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec2</span>,  size<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;       arrival N1 N2 mark lambda1 lambda2</span></span>
<span><span class="co">#&gt;  [1,] 0.00000  0  0    0 0.52941 0.52941</span></span>
<span><span class="co">#&gt;  [2,] 0.57028  1  0    1 0.29130 0.29130</span></span>
<span><span class="co">#&gt;  [3,] 1.66175  1  1    1 0.25073 0.28505</span></span>
<span><span class="co">#&gt;  [4,] 2.17979  1  2    1 0.49638 0.38238</span></span>
<span><span class="co">#&gt;  [5,] 2.47685  1  3    1 0.81319 0.54975</span></span>
<span><span class="co">#&gt;  [6,] 2.64001  2  3    1 1.24825 0.78866</span></span>
<span><span class="co">#&gt;  [7,] 2.70249  3  3    1 1.54519 1.49341</span></span>
<span><span class="co">#&gt;  [8,] 2.94547  4  3    1 1.26810 1.46968</span></span>
<span><span class="co">#&gt;  [9,] 3.39313  4  4    1 0.77271 0.99242</span></span>
<span><span class="co">#&gt; [10,] 3.52533  4  5    1 1.29379 1.15989</span></span>
<span><span class="co">#&gt; [11,] 3.56971  5  5    1 2.00432 1.52115</span></span>
<span><span class="co">#&gt; [12,] 3.70761  5  6    1 1.88965 1.82866</span></span>
<span><span class="co">#&gt; [13,] 4.30122  5  7    1 0.88106 0.75983</span></span>
<span><span class="co">#&gt; [14,] 4.34337  6  7    1 1.63800 1.16393</span></span>
<span><span class="co">#&gt; [15,] 4.40222  7  7    1 1.89764 1.83275</span></span>
<span><span class="co">#&gt; [16,] 4.58943  8  7    1 1.64219 1.86211</span></span>
<span><span class="co">#&gt; [17,] 5.14665  9  7    1 0.75437 0.93131</span></span>
<span><span class="co">#&gt; [18,] 5.18186  9  8    1 1.17407 1.70707</span></span>
<span><span class="co">#&gt; [19,] 5.36167  9  9    1 1.45050 1.53925</span></span>
<span><span class="co">#&gt; [20,] 5.89118 10  9    1 0.85331 0.75875</span></span>
<span><span class="co">#&gt; ... with 980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<p>In multivariate models, <code>type</code> is crucial as it represents
the type of event.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Under bi-variate model, there are two types, 1 or 2.</span></span>
<span><span class="va">res2</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] 0 1 2 2 2 1 1 1 2 2</span></span></code></pre></div>
<p>In multivariate models, the column names of <code>N</code> are
<code>N1</code>, <code>N2</code>, <code>N3</code>, and so on.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span><span class="op">$</span><span class="va">N</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;      N1 N2</span></span>
<span><span class="co">#&gt; [1,]  0  0</span></span>
<span><span class="co">#&gt; [2,]  1  0</span></span>
<span><span class="co">#&gt; [3,]  1  1</span></span></code></pre></div>
<p>Similarly, the column names of <code>lambda</code> are
<code>lambda1</code>, <code>lambda2</code>, <code>lambda3</code>, and so
on.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;        lambda1   lambda2</span></span>
<span><span class="co">#&gt; [1,] 0.5294118 0.5294118</span></span>
<span><span class="co">#&gt; [2,] 0.2913028 0.2913028</span></span>
<span><span class="co">#&gt; [3,] 0.2507301 0.2850475</span></span></code></pre></div>
<p>The column names of <code>lambda_component</code> are
<code>lambda_component11</code>, <code>lambda_component12</code>,
<code>lambda_component13</code>, and so on.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span><span class="op">$</span><span class="va">lambda_component</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;        lambda11    lambda12   lambda21    lambda22</span></span>
<span><span class="co">#&gt; [1,] 0.11764706 0.211764706 0.21176471 0.117647059</span></span>
<span><span class="co">#&gt; [2,] 0.03260813 0.058694641 0.05869464 0.032608134</span></span>
<span><span class="co">#&gt; [3,] 0.04569443 0.005035631 0.08224997 0.002797573</span></span></code></pre></div>
<p>By definition, the following two expressions are equivalent:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res2</span><span class="op">$</span><span class="va">lambda_component</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda11"</span>, <span class="st">"lambda12"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5294118 0.2913028 0.2507301 0.4963769 0.8131889</span></span>
<span><span class="va">res2</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"lambda1"</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.5294118 0.2913028 0.2507301 0.4963769 0.8131889</span></span></code></pre></div>
<p>From the results, we obtain vectors of realized
<code>inter_arrival</code> and <code>type</code>. A bivariate model
requires both <code>inter_arrival</code> and <code>type</code> for
estimation.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter_arrival2</span> <span class="op">&lt;-</span> <span class="va">res2</span><span class="op">$</span><span class="va">inter_arrival</span></span>
<span><span class="va">type2</span> <span class="op">&lt;-</span> <span class="va">res2</span><span class="op">$</span><span class="va">type</span></span></code></pre></div>
<p>The log-likelihood is computed using the <code>logLik</code>
function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hspec2</span>, inter_arrival <span class="op">=</span> <span class="va">inter_arrival2</span>, type <span class="op">=</span> <span class="va">type2</span><span class="op">)</span></span>
<span><span class="co">#&gt; The initial values for intensity processes are not provided. Internally determined initial values are used.</span></span>
<span><span class="co">#&gt; loglikelihood </span></span>
<span><span class="co">#&gt;     -974.2809</span></span></code></pre></div>
<p>Maximum log-likelihood estimation is performed using the
<code>hfit</code> function. In this process, the parameter values in
<code>hspec0</code>, such as <code>mu</code>, <code>alpha</code>, and
<code>beta</code>, serve as starting points for the numerical
optimization. For illustration purposes, we set
<code>hspec0 &lt;- hspec2</code>. Since the true parameter values are
unknown in practical applications, these initial guesses are used. The
realized <code>inter_arrival</code> and <code>type</code> data are
utilized for estimation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hspec0</span> <span class="op">&lt;-</span> <span class="va">hspec2</span></span>
<span><span class="va">mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec0</span>, inter_arrival <span class="op">=</span> <span class="va">inter_arrival2</span>, type <span class="op">=</span> <span class="va">type2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 36 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -970.1408 </span></span>
<span><span class="co">#&gt; 4  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.19095    0.01636  11.671  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1  0.48217    0.07405   6.511 7.45e-11 ***</span></span>
<span><span class="co">#&gt; alpha1.2  0.98625    0.09495  10.387  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1   2.07987    0.16952  12.269  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mle</span><span class="op">)</span></span>
<span><span class="co">#&gt;       mu1  alpha1.1  alpha1.2   beta1.1 </span></span>
<span><span class="co">#&gt; 0.1909541 0.4821725 0.9862542 2.0798691</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">miscTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/miscTools/man/stdEr.html" class="external-link">stdEr</a></span><span class="op">(</span><span class="va">mle</span><span class="op">)</span></span>
<span><span class="co">#&gt;        mu1   alpha1.1   alpha1.2    beta1.1 </span></span>
<span><span class="co">#&gt; 0.01636127 0.07405118 0.09495461 0.16952428</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameter-setting">Parameter setting<a class="anchor" aria-label="anchor" href="#parameter-setting"></a>
</h3>
<p>This subsection explores the relationship between parameter settings
and the estimation procedure in a multivariate Hawkes model. The number
of parameters to be estimated in the model is influenced by how we
configure parameter slots such as <code>mu</code>, <code>alpha</code>,
and <code>beta</code> in <code>hspec0</code>, which specifies the
initial values.</p>
<p>Since the parameter slot <code>alpha</code> is a matrix, its elements
can either be the same or different. Consequently, the number of
parameters estimated varies depending on whether the initial settings
have identical or distinct elements.</p>
<p>For example, if <code>alpha[1,1]</code> and <code>alpha[1,2]</code>
in <code>hspec0</code> are initially set to different values, the
numerical procedure will estimate <code>alpha[1,1]</code> and
<code>alpha[1,2]</code> separately. Conversely, if
<code>alpha[1,1]</code> and <code>alpha[1,2]</code> are the same in the
initial setting, the estimation procedure treats these parameters as
identical in the model, thus estimating only one value.</p>
<p>Recall that the example in the previous section features a symmetric
Hawkes model, where the matrix <code>alpha</code> is symmetric and all
elements of <code>beta</code> are identical.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hspec2</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  0.2</span></span>
<span><span class="co">#&gt; [2,]  0.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.5  0.9</span></span>
<span><span class="co">#&gt; [2,]  0.9  0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 2.25 2.25</span></span>
<span><span class="co">#&gt; [2,] 2.25 2.25</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec2</span>, size <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>In the first estimation example, the initial value of
<code>alpha0</code> is a matrix where all elements are set to the same
value of 0.75. In this configuration, <code>hfit</code> assumes that
<code>alpha11</code>, <code>alpha12</code>, <code>alpha21</code>, and
<code>alpha22</code> are identical in the model, even if the actual
parameters have different values. Similarly, the parameter matrices
<code>mu0</code> and <code>beta0</code> are treated in the same
manner.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.15</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hspec0</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu0</span>, alpha<span class="op">=</span><span class="va">alpha0</span>, beta<span class="op">=</span><span class="va">beta0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec0</span>, inter_arrival <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 44 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -979.5687 </span></span>
<span><span class="co">#&gt; 3  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.19125    0.01636   11.69  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1  0.73981    0.05951   12.43  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1   2.09707    0.16524   12.69  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>Note that in the above result, <code>alpha1.1</code> falls somewhere
between the original values of <code>alpha1.1 = 0.5</code> and
<code>alpha1.2 = 0.9</code>.</p>
<p>In the following second example, the elements of <code>alpha0</code>
are not identical but are symmetric, reflecting the original values used
in the simulation. Specifically, we have <code>alpha11 == alpha22</code>
and <code>alpha12 == alpha21</code> in <code>alpha0</code>, so
<code>alpha11</code> and <code>alpha12</code> will be estimated
differently.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.15</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.751</span>, <span class="fl">0.751</span>, <span class="fl">0.75</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hspec0</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu0</span>, alpha<span class="op">=</span><span class="va">alpha0</span>, beta<span class="op">=</span><span class="va">beta0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec0</span>, inter_arrival <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 30 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -970.1408 </span></span>
<span><span class="co">#&gt; 4  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.19095    0.01643  11.619 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1  0.48226    0.07421   6.499 8.1e-11 ***</span></span>
<span><span class="co">#&gt; alpha1.2  0.98626    0.09538  10.341 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1   2.08008    0.17303  12.021 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>In the third example, the estimation is performed under the
assumption that <code>mu1</code> and <code>mu2</code> may differ, even
though they are the same in the original model.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.14</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.751</span>, <span class="fl">0.751</span>, <span class="fl">0.75</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hspec0</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu0</span>, alpha<span class="op">=</span><span class="va">alpha0</span>, beta<span class="op">=</span><span class="va">beta0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec0</span>, inter_arrival <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 42 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -969.9914 </span></span>
<span><span class="co">#&gt; 5  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.18300    0.02154   8.495  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; mu2       0.19872    0.02203   9.020  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1  0.48149    0.07425   6.484 8.91e-11 ***</span></span>
<span><span class="co">#&gt; alpha1.2  0.98720    0.09556  10.331  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1   2.07973    0.17094  12.166  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>By setting <code>reduced = FALSE</code>, all parameters are
estimated.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec2</span>, inter_arrival <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">type</span>, reduced<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 51 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -966.5055 </span></span>
<span><span class="co">#&gt; 10  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.17997    0.02312   7.784 7.05e-15 ***</span></span>
<span><span class="co">#&gt; mu2       0.20060    0.02442   8.214  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1  0.44726    0.16627   2.690  0.00714 ** </span></span>
<span><span class="co">#&gt; alpha2.1  1.17743    0.22909   5.140 2.75e-07 ***</span></span>
<span><span class="co">#&gt; alpha1.2  0.97048    0.14242   6.814 9.47e-12 ***</span></span>
<span><span class="co">#&gt; alpha2.2  0.48979    0.15398   3.181  0.00147 ** </span></span>
<span><span class="co">#&gt; beta1.1   2.52210    1.16375   2.167  0.03022 *  </span></span>
<span><span class="co">#&gt; beta2.1   3.15498    0.67702   4.660 3.16e-06 ***</span></span>
<span><span class="co">#&gt; beta1.2   1.80167    0.25695   7.012 2.35e-12 ***</span></span>
<span><span class="co">#&gt; beta2.2   1.51338    0.54476   2.778  0.00547 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>The same logic applies to all higher-dimensional models.</p>
</div>
<div class="section level3">
<h3 id="residual-process">Residual process<a class="anchor" aria-label="anchor" href="#residual-process"></a>
</h3>
<p>The residual process can be extracted using the <code><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik()</a></code>
function by setting <code>infer = TRUE</code>. When this option is
enabled, the <code>logLik</code> function returns a list that includes
the log-likelihood, inferred intensities, and the residual process. Note
that the inference is based on the object passed to the
<code>logLik</code> function. In the returned object,
<code>res_process1</code> represents the residual process.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">1.2</span>, beta <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">res_rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hrp</span>, size <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inferred result</span></span>
<span><span class="va">infered_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hrp</span>, <span class="va">res_rp</span><span class="op">$</span><span class="va">inter_arrival</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## QQ-plot</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ppoints.html" class="external-link">ppoints</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">infered_res</span><span class="op">$</span><span class="va">res_process1</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">qexp</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, <span class="va">q</span>, xlab<span class="op">=</span><span class="st">"Theoretical Quantiles"</span>,ylab<span class="op">=</span><span class="st">"Sample Quantiles"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">q</span>, distribution<span class="op">=</span><span class="va">qexp</span>,col<span class="op">=</span><span class="st">"blue"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-27-1.png" width="432"></p>
<p>In practical scenarios, the parameter values are usually unknown, so
the model may be estimated before computing the residual processes.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># estimation</span></span>
<span><span class="va">mle_rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>               <span class="va">res_rp</span><span class="op">$</span><span class="va">inter_arrival</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># construct hspec from estimation result</span></span>
<span><span class="va">he</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mle_rp</span><span class="op">)</span><span class="op">[</span><span class="st">"mu1"</span><span class="op">]</span>, </span>
<span>          alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mle_rp</span><span class="op">)</span><span class="op">[</span><span class="st">"alpha1"</span><span class="op">]</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mle_rp</span><span class="op">)</span><span class="op">[</span><span class="st">"beta1"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># infer intensity</span></span>
<span><span class="va">infered_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">he</span>, <span class="va">res_rp</span><span class="op">$</span><span class="va">inter_arrival</span>, <span class="va">res_rp</span><span class="op">$</span><span class="va">type</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rpe</span> <span class="op">&lt;-</span> <span class="va">infered_res</span><span class="op">$</span><span class="va">res_process1</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ppoints.html" class="external-link">ppoints</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rpe</span>, p<span class="op">=</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">qexp</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, <span class="va">q</span>, xlab<span class="op">=</span><span class="st">"Theoretical Quantiles"</span>,ylab<span class="op">=</span><span class="st">"Sample Quantiles"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">q</span>, distribution<span class="op">=</span><span class="va">qexp</span>,col<span class="op">=</span><span class="st">"blue"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-28-1.png" width="432"></p>
<p>In an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>-dimensional
model, we can compute the residuals in a similar manner. In this case,
the object returned by the <code>logLik</code> function contains
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
residual processes. For example, in the following code,
<code>infer_res2$res_process1</code> and
<code>infer_res2$res_process2</code> represent the residual processes
for each type.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrp2</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>           alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">1.2</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>           beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_hrp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hrp2</span>, size <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">infer_res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hrp2</span>, <span class="va">res_hrp2</span><span class="op">$</span><span class="va">inter_arrival</span>, <span class="va">res_hrp2</span><span class="op">$</span><span class="va">type</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ppoints.html" class="external-link">ppoints</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">infer_res2</span><span class="op">$</span><span class="va">res_process1</span>, <span class="va">infer_res2</span><span class="op">$</span><span class="va">res_process2</span><span class="op">)</span>, p<span class="op">=</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">qexp</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, <span class="va">q</span>, xlab<span class="op">=</span><span class="st">"Theoretical Quantiles"</span>,ylab<span class="op">=</span><span class="st">"Sample Quantiles"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">q</span>, distribution<span class="op">=</span><span class="va">qexp</span>,col<span class="op">=</span><span class="st">"blue"</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-29-1.png" width="432"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Infer the residual process using the log-likelihood method</span></span>
<span><span class="co"># 'infer_res_dh1' contains the inferred process data based on the inter-arrival times</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">infer_res2</span><span class="op">$</span><span class="va">res_process1</span>, <span class="va">infer_res2</span><span class="op">$</span><span class="va">res_process2</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inferred Residual Process"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Residual Value"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Density"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="st">"Theoretical PDF"</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="more-complicated-model">More complicated model<a class="anchor" aria-label="anchor" href="#more-complicated-model"></a>
</h2>
<div class="section level3">
<h3 id="multi-kernel-model">Multi-kernel model<a class="anchor" aria-label="anchor" href="#multi-kernel-model"></a>
</h3>
<p>In a multi-kernel Hawkes model, <code>type_col_map</code> is required
for <code>hspec</code>. <code>type_col_map</code> is a list that
represents the mapping between type and column number. For example,
consider a bi-variate multi-kernel model:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>t</mi></msub><mo>=</mo><mi>μ</mi><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\lambda_t = \mu + \int_{-\infty}^{t} h(t-u) d N(u)
</annotation></semantics></math> where
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>h</mi><mi>k</mi></msub><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>h</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>k</mi></msub><mo>∘</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mrow><mi>k</mi><mn>11</mn></mrow></msub><mi>t</mi></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mrow><mi>k</mi><mn>12</mn></mrow></msub><mi>t</mi></mrow></msup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mrow><mi>k</mi><mn>21</mn></mrow></msub><mi>t</mi></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mrow><mi>k</mi><mn>22</mn></mrow></msub><mi>t</mi></mrow></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex"> h = \sum_{k=1}^{K} h_k, \quad 
h_k (t) = \alpha_k \circ \begin{bmatrix}
e^{-\beta_{k11} t} &amp; e^{-\beta_{k12} t} \\
e^{-\beta_{k21} t} &amp; e^{-\beta_{k22} t}
\end{bmatrix}
 </annotation></semantics></math></p>
<p>with matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\alpha_k</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
denoting kernel number.</p>
<p>For example, in a bi-variate Hawkes model with two kernels, the
intensity processes are</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>λ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>λ</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>2</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>111</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>111</mn></msub><mi>t</mi></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>112</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>112</mn></msub><mi>t</mi></mrow></msup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>121</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>121</mn></msub><mi>t</mi></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>122</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>122</mn></msub><mi>t</mi></mrow></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>d</mi><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>d</mi><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>211</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>211</mn></msub><mi>t</mi></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>212</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>212</mn></msub><mi>t</mi></mrow></msup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>221</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>221</mn></msub><mi>t</mi></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>222</mn></msub><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mn>222</mn></msub><mi>t</mi></mrow></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>d</mi><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>d</mi><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
 \begin{bmatrix} \lambda_1(t) \\ \lambda_2(t) \end{bmatrix} = 
\begin{bmatrix} \mu_1 \\ \mu_2 \end{bmatrix} + \int_{-\infty}^{t} \begin{bmatrix}
\alpha_{111} e^{-\beta_{111} t} &amp; \alpha_{112} e^{-\beta_{112} t} \\
\alpha_{121}e^{-\beta_{121} t} &amp; \alpha_{122}e^{-\beta_{122} t}
\end{bmatrix} \begin{bmatrix} d N_1(s) \\ dN_2(s) \end{bmatrix} 
+ \int_{-\infty}^{t} \begin{bmatrix}
\alpha_{211} e^{-\beta_{211} t} &amp; \alpha_{212} e^{-\beta_{212} t} \\
\alpha_{221}e^{-\beta_{221} t} &amp; \alpha_{222}e^{-\beta_{222} t}
\end{bmatrix} \begin{bmatrix} d N_1(s) \\ dN_2(s) \end{bmatrix}.
</annotation></semantics></math></p>
<p>The parameter matrix is defined by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>111</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>112</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>211</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>212</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>121</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>122</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>221</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>222</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>β</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>111</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>112</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>211</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>212</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>121</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>122</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>221</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>222</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="1.0em"></mspace></mrow><annotation encoding="application/x-tex">
 \alpha = \begin{bmatrix} \alpha_{111} &amp; \alpha_{112} &amp; \alpha_{211} &amp; \alpha_{212} \\ \alpha_{121} &amp; \alpha_{122} &amp; \alpha_{221} &amp; \alpha_{222}
\end{bmatrix}, \quad
 \beta = \begin{bmatrix} \beta_{111} &amp; \beta_{112} &amp; \beta_{211} &amp; \beta_{212} \\ \beta_{121} &amp; \beta_{122} &amp; \beta_{221} &amp; \beta_{222}
\end{bmatrix} \quad
</annotation></semantics></math></p>
<p>and we should specify which columns of matrix are associated with
which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>i</mi></msub><annotation encoding="application/x-tex">N_i</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.02</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>      </span>
<span><span class="va">beta_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">beta_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">beta</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">beta_1</span>, <span class="va">beta_2</span><span class="op">)</span></span>
<span>      </span>
<span><span class="va">alpha_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>,</span>
<span>                    <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">alpha_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.2</span>,</span>
<span>                    <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">alpha_1</span>, <span class="va">alpha_2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    3    2  0.3  0.2</span></span>
<span><span class="co">#&gt; [2,]    2    3  0.2  0.3</span></span></code></pre></div>
<p>Note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d N_1(s)</annotation></semantics></math>
is multiplied by first and third columns of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">dN_2(s)</annotation></semantics></math>
is multiplied by second and fourth columns of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and hence <code>type_col_map</code> is</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type_col_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,  <span class="co"># columns for dN1</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>  <span class="co"># columns for dN2</span></span>
<span><span class="va">type_col_map</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 4</span></span></code></pre></div>
<p>where type <code>i</code> is associated with columns of
<code>type_col_map[[i]]</code>. Thus,</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Part of alpha associated with N1: \n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Part of alpha associated with N1:</span></span>
<span><span class="va">alpha</span><span class="op">[</span>, <span class="va">type_col_map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>  <span class="co"># associated with N1</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    3  0.3</span></span>
<span><span class="co">#&gt; [2,]    2  0.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Part of alpha associated with N2: \n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Part of alpha associated with N2:</span></span>
<span><span class="va">alpha</span><span class="op">[</span>, <span class="va">type_col_map</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>  <span class="co"># associated with N2</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    2  0.2</span></span>
<span><span class="co">#&gt; [2,]    3  0.3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Part of beta associated with N1: \n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Part of beta associated with N1:</span></span>
<span><span class="va">beta</span><span class="op">[</span>, <span class="va">type_col_map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>  <span class="co"># associated with N1</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]   10    1</span></span>
<span><span class="co">#&gt; [2,]   10    1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Part of beta associated with N2: \n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Part of beta associated with N2:</span></span>
<span><span class="va">beta</span><span class="op">[</span>, <span class="va">type_col_map</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>  <span class="co"># associated with N2</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]   10    1</span></span>
<span><span class="co">#&gt; [2,]   10    1</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="va">mu</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta<span class="op">=</span><span class="va">beta</span>, type_col_map <span class="op">=</span> <span class="va">type_col_map</span><span class="op">)</span></span>
<span><span class="va">h</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.02</span></span>
<span><span class="co">#&gt; [2,] 0.02</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    3    2  0.3  0.2</span></span>
<span><span class="co">#&gt; [2,]    2    3  0.2  0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]   10   10    1    1</span></span>
<span><span class="co">#&gt; [2,]   10   10    1    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot type_col_map: </span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 4</span></span></code></pre></div>
<p>In addition, <code>lambda_component0</code> should be provided for
simulation and estimation.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">620</span><span class="op">)</span></span>
<span><span class="va">res_mk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">h</span>, size <span class="op">=</span> <span class="fl">3000</span>, </span>
<span>               <span class="co"># for an illustration purpose</span></span>
<span>               lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.7</span>, <span class="fl">0.1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">res_mk</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.02</span></span>
<span><span class="co">#&gt; [2,] 0.02</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    3    2  0.3  0.2</span></span>
<span><span class="co">#&gt; [2,]    2    3  0.2  0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]   10   10    1    1</span></span>
<span><span class="co">#&gt; [2,]   10   10    1    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot type_col_map: </span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;       arrival N1 N2 mark lambda1 lambda2  lambda11  lambda12 lambda13 lambda14</span></span>
<span><span class="co">#&gt;  [1,]  0.0000  0  0    0   5.220   5.620 1.0000000 1.200e+00   1.4000   1.6000</span></span>
<span><span class="co">#&gt;  [2,]  0.3339  1  0    1   2.247   2.397 0.0354893 4.259e-02   1.0026   1.1459</span></span>
<span><span class="co">#&gt;  [3,]  1.2043  1  1    1   1.046   1.064 0.0005036 7.065e-06   0.5455   0.4799</span></span>
<span><span class="co">#&gt;  [4,]  1.2103  2  1    1   3.122   4.182 0.0004743 1.884e+00   0.5423   0.6758</span></span>
<span><span class="co">#&gt;  [5,]  1.3704  3  1    1   2.299   2.302 0.6051446 3.799e-01   0.7176   0.5758</span></span>
<span><span class="co">#&gt;  [6,]  1.4098  3  2    1   4.238   3.474 2.4298143 2.561e-01   0.9783   0.5535</span></span>
<span><span class="co">#&gt;  [7,]  1.5416  3  3    1   2.793   2.894 0.6507825 6.043e-01   0.8575   0.6605</span></span>
<span><span class="co">#&gt;  [8,]  1.6639  3  4    1   2.498   2.919 0.1914158 7.660e-01   0.7588   0.7614</span></span>
<span><span class="co">#&gt;  [9,]  2.0338  3  5    1   1.282   1.454 0.0047375 6.846e-02   0.5242   0.6642</span></span>
<span><span class="co">#&gt; [10,]  2.1098  4  5    1   2.276   2.981 0.0022151 9.671e-01   0.4858   0.8009</span></span>
<span><span class="co">#&gt; [11,]  2.3626  5  5    1   1.569   1.623 0.2396920 7.722e-02   0.6103   0.6220</span></span>
<span><span class="co">#&gt; [12,]  2.7052  5  6    1   1.216   1.178 0.1053725 2.511e-03   0.6462   0.4416</span></span>
<span><span class="co">#&gt; [13,]  2.7692  5  7    1   2.339   2.939 0.0555568 1.056e+00   0.6062   0.6018</span></span>
<span><span class="co">#&gt; [14,]  2.9333  6  7    1   1.818   2.272 0.0107638 5.920e-01   0.5144   0.6804</span></span>
<span><span class="co">#&gt; [15,]  3.0063  7  7    1   3.146   2.862 1.4508962 2.853e-01   0.7571   0.6325</span></span>
<span><span class="co">#&gt; [16,]  3.3222  7  8    1   1.453   1.365 0.1889842 1.211e-02   0.7707   0.4612</span></span>
<span><span class="co">#&gt; [17,]  3.3779  7  9    1   2.636   3.241 0.1082998 1.153e+00   0.7290   0.6254</span></span>
<span><span class="co">#&gt; [18,]  3.4084  8  9    1   3.931   5.226 0.0798097 2.324e+00   0.7071   0.8006</span></span>
<span><span class="co">#&gt; [19,]  3.7871  8 10    1   1.380   1.425 0.0698539 5.270e-02   0.6897   0.5482</span></span>
<span><span class="co">#&gt; [20,]  3.8329  9 10    1   2.736   3.505 0.0441702 1.298e+00   0.6588   0.7147</span></span>
<span><span class="co">#&gt;        lambda21  lambda22 lambda23 lambda24</span></span>
<span><span class="co">#&gt;  [1,] 1.1000000 1.300e+00   1.5000   1.7000</span></span>
<span><span class="co">#&gt;  [2,] 0.0390382 4.614e-02   1.0742   1.2175</span></span>
<span><span class="co">#&gt;  [3,] 0.0003383 7.654e-06   0.5336   0.5098</span></span>
<span><span class="co">#&gt;  [4,] 0.0003186 2.826e+00   0.5304   0.8050</span></span>
<span><span class="co">#&gt;  [5,] 0.4034302 5.699e-01   0.6224   0.6859</span></span>
<span><span class="co">#&gt;  [6,] 1.6198765 3.841e-01   0.7906   0.6594</span></span>
<span><span class="co">#&gt;  [7,] 0.4338551 9.064e-01   0.6930   0.8410</span></span>
<span><span class="co">#&gt;  [8,] 0.1276106 1.149e+00   0.6132   1.0095</span></span>
<span><span class="co">#&gt;  [9,] 0.0031583 1.027e-01   0.4236   0.9046</span></span>
<span><span class="co">#&gt; [10,] 0.0014767 1.451e+00   0.3926   1.1165</span></span>
<span><span class="co">#&gt; [11,] 0.1597947 1.158e-01   0.4602   0.8671</span></span>
<span><span class="co">#&gt; [12,] 0.0702484 3.767e-03   0.4687   0.6156</span></span>
<span><span class="co">#&gt; [13,] 0.0370378 1.584e+00   0.4397   0.8588</span></span>
<span><span class="co">#&gt; [14,] 0.0071759 8.881e-01   0.3731   0.9834</span></span>
<span><span class="co">#&gt; [15,] 0.9672641 4.280e-01   0.5328   0.9142</span></span>
<span><span class="co">#&gt; [16,] 0.1259895 1.817e-02   0.5343   0.6665</span></span>
<span><span class="co">#&gt; [17,] 0.0721999 1.730e+00   0.5053   0.9142</span></span>
<span><span class="co">#&gt; [18,] 0.0532064 3.485e+00   0.4901   1.1777</span></span>
<span><span class="co">#&gt; [19,] 0.0465693 7.905e-02   0.4726   0.8065</span></span>
<span><span class="co">#&gt; [20,] 0.0294468 1.947e+00   0.4514   1.0569</span></span>
<span><span class="co">#&gt; ... with 2980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">h</span>, <span class="va">res_mk</span><span class="op">$</span><span class="va">inter_arrival</span>, <span class="va">res_mk</span><span class="op">$</span><span class="va">type</span>,</span>
<span>             lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.7</span>, <span class="fl">0.1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 69 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: 6084.702 </span></span>
<span><span class="co">#&gt; 7  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1      0.011596   0.007783   1.490 0.136238    </span></span>
<span><span class="co">#&gt; alpha1.1 2.488160   0.242154  10.275  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.2 1.354091   0.362072   3.740 0.000184 ***</span></span>
<span><span class="co">#&gt; alpha1.3 0.057595   0.096770   0.595 0.551729    </span></span>
<span><span class="co">#&gt; alpha1.4 0.253495   0.115586   2.193 0.028298 *  </span></span>
<span><span class="co">#&gt; beta1.1  6.383741   0.301811  21.151  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.3  0.755539   0.217985   3.466 0.000528 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="synchronized-intensity-model">Synchronized intensity model<a class="anchor" aria-label="anchor" href="#synchronized-intensity-model"></a>
</h3>
<p>This model is basically two-kernel model and defined by little bit
complicated reparameterization.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>θ</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>κ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo>+</mo><mover><mi>θ</mi><mo accent="true">̃</mo></mover><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>κ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>θ</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>κ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo>−</mo><mover><mi>θ</mi><mo accent="true">̃</mo></mover><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>κ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>θ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>θ</mi><mo>−</mo></msup><mo>+</mo><msup><mi>θ</mi><mo>+</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo>,</mo><mspace width="1.0em"></mspace><mover><mi>θ</mi><mo accent="true">̃</mo></mover><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>θ</mi><mo>−</mo></msup><mo>−</mo><msup><mi>θ</mi><mo>+</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">
 \mu = \begin{bmatrix} \theta/(1 - \kappa)/2 + \tilde\theta/(1 + \kappa)/2 \\
\theta/(1 - \kappa)/2 - \tilde\theta/(1 + \kappa)/2 \end{bmatrix}, \quad \theta = (\theta^- + \theta^+)/2,\quad \tilde\theta=(\theta^- -\theta^+)/2
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>ζ</mi></mtd><mtd columnalign="center" style="text-align: center"><mover><mi>ζ</mi><mo accent="true">̃</mo></mover></mtd><mtd columnalign="center" style="text-align: center"><mi>ζ</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>−</mo><mover><mi>ζ</mi><mo accent="true">̃</mo></mover></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>ζ</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>−</mo><mover><mi>ζ</mi><mo accent="true">̃</mo></mover></mtd><mtd columnalign="center" style="text-align: center"><mi>ζ</mi></mtd><mtd columnalign="center" style="text-align: center"><mover><mi>ζ</mi><mo accent="true">̃</mo></mover></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>ζ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo>+</mo><mi>ν</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo>,</mo><mspace width="1.0em"></mspace><mover><mi>ζ</mi><mo accent="true">̃</mo></mover><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo>−</mo><mi>ν</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">
\alpha = \begin{bmatrix} \zeta &amp; \tilde\zeta &amp; \zeta &amp; -\tilde\zeta \\
\zeta &amp; -\tilde\zeta &amp; \zeta &amp; \tilde\zeta
\end{bmatrix}, \quad \zeta = (\eta + \nu) / 2, \quad \tilde \zeta = (\eta - \nu)/ 2 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>β</mi><mn>2</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>β</mi><mn>1</mn></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo>+</mo><mi>ν</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>β</mi><mn>2</mn></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>η</mi><mo>−</mo><mi>ν</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">
\beta = \begin{bmatrix} \beta_1 &amp; \beta_2 &amp; \beta_1 &amp; \beta_2 \\
\beta_1 &amp; \beta_2 &amp; \beta_1 &amp; \beta_2 \end{bmatrix}, \quad \beta_1 = (\eta + \nu) / 2, \quad \beta_2 = (\eta - \nu)/2
</annotation></semantics></math></p>
<p>In order to handle complex re-parametrization, each slot is expressed
as a function rather than a matrix. The first argument
<code>param</code> is a set of parameters.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>theta_p <span class="op">=</span> <span class="fl">0.15</span>, theta_n <span class="op">=</span> <span class="fl">0.21</span>, kappa <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">theta</span>    <span class="op">&lt;-</span> <span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"theta_n"</span><span class="op">]</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"theta_p"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">theta_tl</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"theta_n"</span><span class="op">]</span> <span class="op">-</span> <span class="va">param</span><span class="op">[</span><span class="st">"theta_p"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">param</span><span class="op">[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">theta_tl</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           <span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">param</span><span class="op">[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">theta_tl</span><span class="op">/</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>eta <span class="op">=</span> <span class="fl">5</span>, nu <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">zeta</span>    <span class="op">&lt;-</span> <span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"eta"</span><span class="op">]</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"nu"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">zeta_tl</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"eta"</span><span class="op">]</span> <span class="op">-</span> <span class="va">param</span><span class="op">[</span><span class="st">"nu"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">zeta</span>, <span class="va">zeta_tl</span>, <span class="va">zeta</span>, <span class="op">-</span><span class="va">zeta_tl</span>,</span>
<span>           <span class="va">zeta</span>, <span class="op">-</span><span class="va">zeta_tl</span>, <span class="va">zeta</span>, <span class="va">zeta_tl</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">12</span>, kappa <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">beta1</span> <span class="op">&lt;-</span> <span class="va">param</span><span class="op">[</span><span class="st">"beta"</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">param</span><span class="op">[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta2</span> <span class="op">&lt;-</span> <span class="va">param</span><span class="op">[</span><span class="st">"beta"</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">beta1</span>, <span class="va">beta2</span>, <span class="va">beta1</span>, <span class="va">beta2</span>,</span>
<span>           <span class="va">beta1</span>, <span class="va">beta2</span>, <span class="va">beta1</span>, <span class="va">beta2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">type_col_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">h_sy</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="va">mu</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, type_col_map <span class="op">=</span> <span class="va">type_col_map</span><span class="op">)</span></span>
<span><span class="va">h_sy</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt; function (param = c(theta_p = 0.15, theta_n = 0.21, kappa = 0.12)) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     theta &lt;- (param["theta_n"] + param["theta_p"])/2</span></span>
<span><span class="co">#&gt;     theta_tl &lt;- (param["theta_n"] - param["theta_p"])/2</span></span>
<span><span class="co">#&gt;     matrix(c(theta/2/(1 - param["kappa"]) + theta_tl/2/(1 + param["kappa"]), </span></span>
<span><span class="co">#&gt;         theta/2/(1 - param["kappa"]) - theta_tl/2/(1 + param["kappa"])), </span></span>
<span><span class="co">#&gt;         nrow = 2)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x557df882bb10&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt; function (param = c(eta = 5, nu = 3)) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     zeta &lt;- (param["eta"] + param["nu"])/2</span></span>
<span><span class="co">#&gt;     zeta_tl &lt;- (param["eta"] - param["nu"])/2</span></span>
<span><span class="co">#&gt;     matrix(c(zeta, zeta_tl, zeta, -zeta_tl, zeta, -zeta_tl, zeta, </span></span>
<span><span class="co">#&gt;         zeta_tl), nrow = 2, byrow = TRUE)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x557df8a38e08&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt; function (param = c(beta = 12, kappa = 0.12)) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     beta1 &lt;- param["beta"] * (1 - param["kappa"])</span></span>
<span><span class="co">#&gt;     beta2 &lt;- param["beta"] * (1 + param["kappa"])</span></span>
<span><span class="co">#&gt;     matrix(c(beta1, beta2, beta1, beta2, beta1, beta2, beta1, </span></span>
<span><span class="co">#&gt;         beta2), nrow = 2, byrow = TRUE)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x557df94fa080&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot type_col_map: </span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 3 4</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="co"># run simulation</span></span>
<span><span class="va">res_sy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">h_sy</span>, size <span class="op">=</span> <span class="fl">2000</span>, lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_sy</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;       arrival N1 N2 mark lambda1 lambda2</span></span>
<span><span class="co">#&gt;  [1,]  0.0000  0  0    0 4.11567 4.08888</span></span>
<span><span class="co">#&gt;  [2,]  7.2506  0  1    1 0.11567 0.08888</span></span>
<span><span class="co">#&gt;  [3,]  7.4805  0  2    1 0.42304 0.48724</span></span>
<span><span class="co">#&gt;  [4,]  7.4915  1  2    1 3.09049 4.86829</span></span>
<span><span class="co">#&gt;  [5,] 17.7981  2  2    1 0.11567 0.08888</span></span>
<span><span class="co">#&gt;  [6,] 20.0276  2  3    1 0.11567 0.08888</span></span>
<span><span class="co">#&gt;  [7,] 20.0484  2  4    1 2.56966 4.05419</span></span>
<span><span class="co">#&gt;  [8,] 20.0609  3  4    1 4.94847 7.88899</span></span>
<span><span class="co">#&gt;  [9,] 20.1607  4  4    1 3.58697 3.81330</span></span>
<span><span class="co">#&gt; [10,] 20.2304  5  4    1 4.09539 3.38445</span></span>
<span><span class="co">#&gt; [11,] 20.5057  5  5    1 0.56602 0.47289</span></span>
<span><span class="co">#&gt; [12,] 26.4862  6  5    1 0.11567 0.08888</span></span>
<span><span class="co">#&gt; [13,] 32.5114  6  6    1 0.11567 0.08888</span></span>
<span><span class="co">#&gt; [14,] 32.6227  6  7    1 1.12663 1.54804</span></span>
<span><span class="co">#&gt; [15,] 32.6316  6  8    1 3.79509 5.94053</span></span>
<span><span class="co">#&gt; [16,] 32.6480  7  8    1 5.81283 9.13210</span></span>
<span><span class="co">#&gt; [17,] 32.6921  7  9    1 6.87877 7.59586</span></span>
<span><span class="co">#&gt; [18,] 32.7953  8  9    1 3.51752 4.17621</span></span>
<span><span class="co">#&gt; [19,] 32.9249  8 10    1 2.20298 1.94570</span></span>
<span><span class="co">#&gt; [20,] 34.7648  9 10    1 0.11567 0.08888</span></span>
<span><span class="co">#&gt; ... with 1980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<p>The estimation is based on function arguments <code>param</code>. In
addition, the initial values of the numerical optimization is the
default values specified in <code>param</code>. Note that the same name
arguments are treated as the same parameter. <code>kappa</code> is in
both of <code>mu</code> and <code>beta</code>, but only one
<code>kappa</code> appears in the estimation result.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">h_sy</span>, inter_arrival<span class="op">=</span><span class="va">res_sy</span><span class="op">$</span><span class="va">inter_arrival</span>, </span>
<span>               type<span class="op">=</span><span class="va">res_sy</span><span class="op">$</span><span class="va">type</span>,</span>
<span>               lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_sy</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 77 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -260.6273 </span></span>
<span><span class="co">#&gt; 6  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;         Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; theta_p  0.08291    0.01587   5.223 1.76e-07 ***</span></span>
<span><span class="co">#&gt; theta_n  0.16264    0.01695   9.594  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; kappa    0.40990    0.02294  17.866  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; eta      5.23253    0.36946  14.163  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nu       2.89429    0.32969   8.779  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta    18.01820        NaN     NaN      NaN    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extended-model">Extended model<a class="anchor" aria-label="anchor" href="#extended-model"></a>
</h2>
<p>The following family of extended multi-variate marked Hawkes models
are implemented:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>μ</mi><mo>+</mo><msub><mo>∫</mo><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mi>∞</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>E</mi></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>u</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>d</mi><mi>u</mi><mo>×</mo><mi>d</mi><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
 \lambda(t) = \mu + \int_{(-\infty,t)\times E} h(t, u, z)M(du \times dz)
</annotation></semantics></math></p>
<p>where the kernel
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
is represented by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>u</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>+</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
h(t, u, z) = (\alpha + g(t, z))\Gamma(t),
</annotation></semantics></math></p>
<p>and</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is a constant matrix,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t, z)</annotation></semantics></math>
is additional impacts on intensities, which may depend on mark, or any
information generated by underlying processes,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Gamma(t)</annotation></semantics></math>
is exponential decaying matrix such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Γ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>β</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup></mrow><annotation encoding="application/x-tex">\Gamma_{ij}(t) = e^{-\beta_{ij}(t)}</annotation></semantics></math>,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
denotes the random measures defined on the product of time and mark
spaces.</p></li>
</ul>
<div class="section level3">
<h3 id="linear-impact-model">Linear impact model<a class="anchor" aria-label="anchor" href="#linear-impact-model"></a>
</h3>
<p>In the linear impact model,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
 g(t, z) = \eta (z-1).
</annotation></semantics></math></p>
<p><code>impact</code> represents
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ψ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Psi(z)</annotation></semantics></math>,
the impact of mark on future intensity. For details, see <a href="https://www.sciencedirect.com/science/article/abs/pii/S0927539816300810" class="external-link">Marked
Hawkes process modeling of price dynamics and volatility
estimation</a>.</p>
<p>It is a function, and the first argument is <code>param</code>
represents the parameter of the model. <code>impact()</code> function
can have additional arguments related to the model specification or
generated path, such as <code>n</code>, <code>mark</code>, etc. Do not
miss <code>...</code> as the ellipsis is omitted, an error occurs.
<code>rmark()</code> is a function that generate marks for
simulation.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.15</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span>, <span class="fl">2.6</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">rmark</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.65</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">rgeom</a></span><span class="op">(</span><span class="fl">1</span>, p<span class="op">=</span><span class="va">param</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">impact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>eta1<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>, <span class="va">alpha</span>, <span class="va">n</span>, <span class="va">mark</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mark</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">ma</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"eta1"</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">hi</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu</span>, alpha<span class="op">=</span><span class="va">alpha</span>, beta<span class="op">=</span><span class="va">beta</span>,</span>
<span>          rmark <span class="op">=</span> <span class="va">rmark</span>,</span>
<span>          impact<span class="op">=</span><span class="va">impact</span><span class="op">)</span></span>
<span><span class="va">hi</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.15</span></span>
<span><span class="co">#&gt; [2,] 0.15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.75 0.60</span></span>
<span><span class="co">#&gt; [2,] 0.60 0.75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  2.6  2.6</span></span>
<span><span class="co">#&gt; [2,]  2.6  2.6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot impact: </span></span>
<span><span class="co">#&gt; function (param = c(eta1 = 0.2), alpha, n, mark, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     ma &lt;- matrix(rep(mark[n] - 1, 4), nrow = 2)</span></span>
<span><span class="co">#&gt;     ma * matrix(rep(param["eta1"], 4), nrow = 2)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot rmark: </span></span>
<span><span class="co">#&gt; function (param = c(p = 0.65), ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     rgeom(1, p = param[1]) + 1</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">res_impact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hi</span>, size<span class="op">=</span><span class="fl">1000</span>, lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_impact</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;       arrival N1 N2 mark lambda1 lambda2</span></span>
<span><span class="co">#&gt;  [1,]  0.0000  0  0    0 0.35000 0.35000</span></span>
<span><span class="co">#&gt;  [2,]  1.3001  0  1    1 0.15681 0.15681</span></span>
<span><span class="co">#&gt;  [3,]  2.5585  1  1    2 0.17302 0.17871</span></span>
<span><span class="co">#&gt;  [4,]  2.7982  1  2    1 0.67171 0.59433</span></span>
<span><span class="co">#&gt;  [5,]  3.0525  2  2    2 0.72904 0.76653</span></span>
<span><span class="co">#&gt;  [6,]  3.3929  3  2    1 0.78108 0.73464</span></span>
<span><span class="co">#&gt;  [7,]  3.4509  4  2    3 1.33764 1.16872</span></span>
<span><span class="co">#&gt;  [8,]  3.5101  5  2    2 2.15429 1.88085</span></span>
<span><span class="co">#&gt;  [9,]  3.5837  6  2    1 2.58987 2.24016</span></span>
<span><span class="co">#&gt; [10,]  3.6041  7  2    1 3.17455 2.70074</span></span>
<span><span class="co">#&gt; [11,]  3.7053  8  2    1 3.05159 2.57205</span></span>
<span><span class="co">#&gt; [12,]  3.9277  9  2    1 2.19788 1.84482</span></span>
<span><span class="co">#&gt; [13,]  3.9610 10  2    1 2.71584 2.25450</span></span>
<span><span class="co">#&gt; [14,]  4.2448 11  2    1 1.73576 1.44339</span></span>
<span><span class="co">#&gt; [15,]  4.7277 12  2    4 0.81551 0.68947</span></span>
<span><span class="co">#&gt; [16,]  5.1473 12  3    1 0.82698 0.73426</span></span>
<span><span class="co">#&gt; [17,]  5.3229 12  4    2 0.95877 0.99505</span></span>
<span><span class="co">#&gt; [18,]  5.4219 13  4    1 1.39371 1.53772</span></span>
<span><span class="co">#&gt; [19,]  5.4869 14  4    2 1.83388 1.82882</span></span>
<span><span class="co">#&gt; [20,]  5.8857 14  5    1 1.08385 1.02887</span></span>
<span><span class="co">#&gt; ... with 980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hi</span>, </span>
<span>            inter_arrival <span class="op">=</span> <span class="va">res_impact</span><span class="op">$</span><span class="va">inter_arrival</span>,</span>
<span>            type <span class="op">=</span> <span class="va">res_impact</span><span class="op">$</span><span class="va">type</span>,</span>
<span>            mark <span class="op">=</span> <span class="va">res_impact</span><span class="op">$</span><span class="va">mark</span>,</span>
<span>            lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">4</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 38 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -1525.501 </span></span>
<span><span class="co">#&gt; 5  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.13190    0.00891  14.804  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1  0.67609    0.07742   8.732  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.2  0.60345    0.07211   8.368  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1   2.22126    0.16730  13.277  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; eta1      0.11635    0.05549   2.097   0.036 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>For a special case of linear impact function, the following
implementation is recommended. In a marked Hawkes model, the additional
linear impact can be represented by slot <code>eta</code>. In this
model, the intensity process is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>μ</mi><mo>+</mo><msub><mo>∫</mo><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mi>∞</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>E</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>+</mo><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mi>M</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>d</mi><mi>t</mi><mo>×</mo><mi>d</mi><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
 \lambda(t) = \mu + \int_{(-\infty, t)\times E} (\alpha + \eta (z-1)) e^{-\beta(t-u)}  M(dt \times dz).
</annotation></semantics></math></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rmark</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.65</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">rgeom</a></span><span class="op">(</span><span class="fl">1</span>, p<span class="op">=</span><span class="va">param</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span>  <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="fl">0.15</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, beta<span class="op">=</span><span class="fl">1.6</span>, eta<span class="op">=</span><span class="fl">0.3</span>,</span>
<span>          rmark <span class="op">=</span> <span class="va">rmark</span><span class="op">)</span></span>
<span><span class="va">h</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 1-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  0.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  1.6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot eta: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot rmark: </span></span>
<span><span class="co">#&gt; function (param = c(p = 0.65), ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     rgeom(1, p = param[1]) + 1</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">h</span>, size <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;       arrival N1 mark lambda1</span></span>
<span><span class="co">#&gt;  [1,]  0.0000  0    0 0.20833</span></span>
<span><span class="co">#&gt;  [2,]  1.9559  1    1 0.15255</span></span>
<span><span class="co">#&gt;  [3,]  3.2143  2    1 0.24381</span></span>
<span><span class="co">#&gt;  [4,]  3.9750  3    1 0.38501</span></span>
<span><span class="co">#&gt;  [5,]  4.5731  4    1 0.50912</span></span>
<span><span class="co">#&gt;  [6,]  7.7740  5    1 0.15632</span></span>
<span><span class="co">#&gt;  [7,] 11.9290  6    2 0.15092</span></span>
<span><span class="co">#&gt;  [8,] 13.4270  7    1 0.24108</span></span>
<span><span class="co">#&gt;  [9,] 23.3482  8    1 0.15000</span></span>
<span><span class="co">#&gt; [10,] 31.9666  9    3 0.15000</span></span>
<span><span class="co">#&gt; [11,] 32.0257 10    2 1.33257</span></span>
<span><span class="co">#&gt; [12,] 32.1598 11    1 1.91124</span></span>
<span><span class="co">#&gt; [13,] 36.9851 12    1 0.15109</span></span>
<span><span class="co">#&gt; [14,] 37.1167 13    2 0.71795</span></span>
<span><span class="co">#&gt; [15,] 38.4261 14    1 0.34298</span></span>
<span><span class="co">#&gt; [16,] 38.9803 15    1 0.51792</span></span>
<span><span class="co">#&gt; [17,] 42.9827 16    2 0.15177</span></span>
<span><span class="co">#&gt; [18,] 48.4580 17    1 0.15016</span></span>
<span><span class="co">#&gt; [19,] 48.7737 18    1 0.57247</span></span>
<span><span class="co">#&gt; [20,] 48.7910 19    2 1.24194</span></span>
<span><span class="co">#&gt; ... with 980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">h</span>, </span>
<span>            inter_arrival <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">inter_arrival</span>,</span>
<span>            type <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">type</span>,</span>
<span>            mark <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">mark</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 37 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -1684.238 </span></span>
<span><span class="co">#&gt; 4  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;        Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1     0.14557    0.00847  17.187  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1  0.63917    0.06892   9.275  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1   1.48983    0.12320  12.092  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; eta1    0.33626    0.07723   4.354 1.34e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>If you want to estimate the mark distribution also, then
<code>dmark</code> slot that describes the density function of mark is
required.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h_md</span> <span class="op">&lt;-</span> <span class="va">h</span></span>
<span></span>
<span><span class="va">h_md</span><span class="op">@</span><span class="va">dmark</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, <span class="va">n</span><span class="op">=</span><span class="va">n</span>, <span class="va">mark</span><span class="op">=</span><span class="va">mark</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">dgeom</a></span><span class="op">(</span><span class="va">mark</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"p"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mle_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">h_md</span>, </span>
<span>               inter_arrival <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">type</span>, mark <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">mark</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle_md</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 46 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -2657.079 </span></span>
<span><span class="co">#&gt; 5  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;        Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1    0.145574   0.008468  17.190  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1 0.639168   0.069753   9.163  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1  1.489843   0.124301  11.986  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; eta1   0.336259   0.076904   4.372 1.23e-05 ***</span></span>
<span><span class="co">#&gt; p      0.658970   0.012203  54.002  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hawkes-flocking-model">Hawkes flocking model<a class="anchor" aria-label="anchor" href="#hawkes-flocking-model"></a>
</h3>
<p>The function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
is not necessarily depend on mark. In the Hawkes flocking model, the
kernel component is represented by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>12</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>12</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>33</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>34</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>34</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mn>33</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\alpha = \begin{bmatrix}\alpha_{11} &amp; \alpha_{12} &amp; 0 &amp; 0 \\\alpha_{12}&amp; \alpha_{11} &amp; 0 &amp; 0 \\0 &amp; 0 &amp; \alpha_{33} &amp; \alpha_{34} \\0 &amp; 0 &amp; \alpha_{34} &amp; \alpha_{33} \end{bmatrix},
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>1</mn><mi>w</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>1</mn><mi>w</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>2</mn><mi>w</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mn>2</mn><mi>w</mi></mrow></msub><msub><mn>1</mn><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex"> 
g = \begin{bmatrix} 0 &amp; 0 &amp; \alpha_{1w} 1_{\{C_1(t) &lt; C_2(t)\}} &amp; \alpha_{1n} 1_{\{C_1(t) &lt; C_2(t)\}} \\ 
0 &amp; 0 &amp; \alpha_{1n} 1_{\{C_1(t) &gt; C_2(t)\}} &amp; \alpha_{1w}1_{\{C_1(t) &gt; C_2(t)\}} \\
\alpha_{2w} 1_{\{C_2(t) &lt; C_1(t)\}} &amp; \alpha_{2n}1_{\{C_2(t) &lt; C_1(t)\}} &amp; 0 &amp; 0 \\
\alpha_{2n} 1_{\{C_2(t) &gt; C_1(t)\}} &amp; \alpha_{2w}1_{\{C_2(t) &gt; C_1(t)\}} &amp; 0 &amp; 0 \end{bmatrix},
</annotation></semantics></math></p>
<p>where</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>C</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mn>3</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>N</mi><mn>4</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
C_1(t) = N_1(t) - N_2(t), \quad C_2(t) = N_3(t) - N_4(t).
</annotation></semantics></math> For details, see <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/fut.22048" class="external-link">Systemic
risk in market microstructure of crude oil and gasoline futures prices:
A Hawkes flocking model approach</a>.</p>
<p>In the basic model, <code>alpha</code> is a matrix, but it can be a
function as in the following code. The function <code>alpha</code>
simply return a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">4\times4</annotation></semantics></math>
matrix but by doing so, we can fix some of elements as specific vales
when estimating. When estimating, the optimization is only applied for
the specified parameters in the argument <code>param</code>. In the case
of simulation, there is no difference whether the parameter set is
represented by a matrix or a function.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.04</span>, <span class="fl">0.04</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>alpha11 <span class="op">=</span> <span class="fl">0.2</span>, alpha12 <span class="op">=</span> <span class="fl">0.3</span>, alpha33 <span class="op">=</span> <span class="fl">0.3</span>, alpha34 <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"alpha11"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha12"</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>           <span class="va">param</span><span class="op">[</span><span class="st">"alpha12"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha11"</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>           <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha33"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha34"</span><span class="op">]</span>,</span>
<span>           <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha34"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha33"</span><span class="op">]</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><code>impact()</code> function is little bit complicated, but it is
nothing more than expressing the definition of the model to an R
function. Note that we specify <code>N=N, n=n</code> in the argument.
<code>N</code> is for counting process
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
and <code>n</code> denotes the time step. Both are needed to implement
the function body and it is required to specify in the argument.
<code>…</code> also should not be omitted.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>alpha1n<span class="op">=</span><span class="fl">0.25</span>, alpha1w<span class="op">=</span><span class="fl">0.1</span>, alpha2n<span class="op">=</span><span class="fl">0.1</span>, alpha2w<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                   <span class="va">N</span><span class="op">=</span><span class="va">N</span>, <span class="va">n</span><span class="op">=</span><span class="va">n</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">Psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">'alpha1w'</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">'alpha1n'</span><span class="op">]</span>,</span>
<span>                  <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">'alpha1n'</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">'alpha1w'</span><span class="op">]</span>,</span>
<span>                  <span class="va">param</span><span class="op">[</span><span class="st">'alpha2w'</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">'alpha2n'</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                  <span class="va">param</span><span class="op">[</span><span class="st">'alpha2n'</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">'alpha2w'</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">4</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ind</span> <span class="op">&lt;-</span> <span class="va">N</span><span class="op">[</span>,<span class="st">"N1"</span><span class="op">]</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">-</span> <span class="va">N</span><span class="op">[</span>,<span class="st">"N2"</span><span class="op">]</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">N</span><span class="op">[</span>,<span class="st">"N3"</span><span class="op">]</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">-</span> <span class="va">N</span><span class="op">[</span>,<span class="st">"N4"</span><span class="op">]</span><span class="op">[</span><span class="va">n</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">!</span><span class="va">ind</span>, <span class="op">!</span><span class="va">ind</span>, <span class="op">!</span><span class="va">ind</span>, <span class="op">!</span><span class="va">ind</span>,</span>
<span>                 <span class="va">ind</span>, <span class="va">ind</span>, <span class="va">ind</span>, <span class="va">ind</span>,</span>
<span>                 <span class="va">ind</span>, <span class="va">ind</span>, <span class="va">ind</span>, <span class="va">ind</span>,</span>
<span>                 <span class="op">!</span><span class="va">ind</span>, <span class="op">!</span><span class="va">ind</span>, <span class="op">!</span><span class="va">ind</span>, <span class="op">!</span><span class="va">ind</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">km</span> <span class="op">*</span> <span class="va">Psi</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">hspec_fl</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>,</span>
<span>                mu <span class="op">=</span> <span class="va">mu</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, impact <span class="op">=</span> <span class="va">impact</span><span class="op">)</span></span>
<span><span class="va">hspec_fl</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 4-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.02</span></span>
<span><span class="co">#&gt; [2,] 0.02</span></span>
<span><span class="co">#&gt; [3,] 0.04</span></span>
<span><span class="co">#&gt; [4,] 0.04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt; function (param = c(alpha11 = 0.2, alpha12 = 0.3, alpha33 = 0.3, </span></span>
<span><span class="co">#&gt;     alpha34 = 0.4)) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     matrix(c(param["alpha11"], param["alpha12"], 0, 0, param["alpha12"], </span></span>
<span><span class="co">#&gt;         param["alpha11"], 0, 0, 0, 0, param["alpha33"], param["alpha34"], </span></span>
<span><span class="co">#&gt;         0, 0, param["alpha34"], param["alpha33"]), nrow = 4, </span></span>
<span><span class="co">#&gt;         byrow = TRUE)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x557df34f5bc0&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]  0.7  0.7  0.7  0.7</span></span>
<span><span class="co">#&gt; [2,]  0.7  0.7  0.7  0.7</span></span>
<span><span class="co">#&gt; [3,]  1.1  1.1  1.1  1.1</span></span>
<span><span class="co">#&gt; [4,]  1.1  1.1  1.1  1.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot impact: </span></span>
<span><span class="co">#&gt; function (param = c(alpha1n = 0.25, alpha1w = 0.1, alpha2n = 0.1, </span></span>
<span><span class="co">#&gt;     alpha2w = 0.2), N = N, n = n, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     Psi &lt;- matrix(c(0, 0, param["alpha1w"], param["alpha1n"], </span></span>
<span><span class="co">#&gt;         0, 0, param["alpha1n"], param["alpha1w"], param["alpha2w"], </span></span>
<span><span class="co">#&gt;         param["alpha2n"], 0, 0, param["alpha2n"], param["alpha2w"], </span></span>
<span><span class="co">#&gt;         0, 0), nrow = 4, byrow = TRUE)</span></span>
<span><span class="co">#&gt;     ind &lt;- N[, "N1"][n] - N[, "N2"][n] &gt; N[, "N3"][n] - N[, "N4"][n]</span></span>
<span><span class="co">#&gt;     km &lt;- matrix(c(!ind, !ind, !ind, !ind, ind, ind, ind, ind, </span></span>
<span><span class="co">#&gt;         ind, ind, ind, ind, !ind, !ind, !ind, !ind), nrow = 4, </span></span>
<span><span class="co">#&gt;         byrow = TRUE)</span></span>
<span><span class="co">#&gt;     km * Psi</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">hr_fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec_fl</span>, size<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hr_fl</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;        arrival N1 N2 N3 N4 mark  lambda1  lambda2  lambda3  lambda4</span></span>
<span><span class="co">#&gt;  [1,]  0.00000  0  0  0  0    0 0.070000 0.070000 0.110000 0.110000</span></span>
<span><span class="co">#&gt;  [2,]  0.84055  0  0  1  0    1 0.047761 0.047761 0.067768 0.067768</span></span>
<span><span class="co">#&gt;  [3,]  7.35095  0  0  2  0    1 0.021340 0.020291 0.040254 0.040332</span></span>
<span><span class="co">#&gt;  [4,]  8.74603  1  0  2  0    1 0.058165 0.020110 0.104718 0.126289</span></span>
<span><span class="co">#&gt;  [5,] 29.54186  2  0  2  0    1 0.020000 0.020000 0.040000 0.040000</span></span>
<span><span class="co">#&gt;  [6,] 30.90333  2  1  2  0    1 0.097114 0.135671 0.040000 0.062366</span></span>
<span><span class="co">#&gt;  [7,] 31.08275  3  1  2  0    1 0.352605 0.298414 0.040000 0.222539</span></span>
<span><span class="co">#&gt;  [8,] 33.42583  4  1  2  0    1 0.123299 0.132184 0.040000 0.061465</span></span>
<span><span class="co">#&gt;  [9,] 33.75532  5  1  2  0    1 0.260826 0.347283 0.179195 0.054939</span></span>
<span><span class="co">#&gt; [10,] 34.28018  6  1  2  0    1 0.325287 0.454414 0.230420 0.048387</span></span>
<span><span class="co">#&gt; [11,] 35.06698  6  2  2  0    1 0.311303 0.443397 0.204307 0.043530</span></span>
<span><span class="co">#&gt; [12,] 35.31209  6  3  2  0    1 0.518076 0.545110 0.241844 0.042695</span></span>
<span><span class="co">#&gt; [13,] 35.91748  6  4  2  0    1 0.542398 0.494637 0.195086 0.041385</span></span>
<span><span class="co">#&gt; [14,] 36.30025  7  4  2  0    1 0.649096 0.536065 0.141792 0.172180</span></span>
<span><span class="co">#&gt; [15,] 36.96094  7  5  2  0    1 0.542096 0.533891 0.185908 0.103906</span></span>
<span><span class="co">#&gt; [16,] 36.99520  7  5  2  1    1 0.822615 0.716974 0.180512 0.294145</span></span>
<span><span class="co">#&gt; [17,] 37.01805  8  5  2  1    1 0.809878 0.804326 0.567094 0.580389</span></span>
<span><span class="co">#&gt; [18,] 37.57785  9  5  2  1    1 0.688962 0.752790 0.432793 0.331931</span></span>
<span><span class="co">#&gt; [19,] 39.12437  9  5  2  2    1 0.314339 0.369832 0.148166 0.093268</span></span>
<span><span class="co">#&gt; [20,] 40.15404 10  5  2  2    1 0.163160 0.238789 0.203723 0.153817</span></span>
<span><span class="co">#&gt; ... with 1980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec_fl</span>, <span class="va">hr_fl</span><span class="op">$</span><span class="va">inter_arrival</span>, <span class="va">hr_fl</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_fl</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 84 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -3050.319 </span></span>
<span><span class="co">#&gt; 12  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;         Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1     0.028055   0.004311   6.509 7.59e-11 ***</span></span>
<span><span class="co">#&gt; mu3     0.033179   0.004284   7.745 9.53e-15 ***</span></span>
<span><span class="co">#&gt; alpha11 0.199720   0.029151   6.851 7.32e-12 ***</span></span>
<span><span class="co">#&gt; alpha12 0.312236   0.030731  10.160  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha33 0.283861   0.037992   7.472 7.93e-14 ***</span></span>
<span><span class="co">#&gt; alpha34 0.341250   0.041153   8.292  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1 0.734703   0.054270  13.538  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; beta3.1 0.899924   0.081923  10.985  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1n 0.250338   0.044096   5.677 1.37e-08 ***</span></span>
<span><span class="co">#&gt; alpha1w 0.107483   0.030036   3.579 0.000346 ***</span></span>
<span><span class="co">#&gt; alpha2n 0.083683   0.038739   2.160 0.030761 *  </span></span>
<span><span class="co">#&gt; alpha2w 0.172788   0.034234   5.047 4.48e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bid-ask-price-model">Bid-ask price model<a class="anchor" aria-label="anchor" href="#bid-ask-price-model"></a>
</h3>
<p>In this model, we use a system of counting processes with the
corresponding conditional intensities to describe the bid-ask price
processes:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>t</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>N</mi><mn>3</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>N</mi><mn>4</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>λ</mi><mi>t</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>λ</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>λ</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>λ</mi><mn>3</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>λ</mi><mn>4</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex"> 
N_t = \begin{bmatrix}
N_1(t) \\ N_2(t) \\ N_3(t) \\ N_4(t)
\end{bmatrix},
\quad
\lambda_t =
\begin{bmatrix} \lambda_1(t) \\ \lambda_2(t) \\ \lambda_3(t) \\ \lambda_4(t)
\end{bmatrix}
</annotation></semantics></math></p>
<p>The ask price process
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_1(t) - N_2(t)</annotation></semantics></math>
and the bid price process is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mn>3</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>N</mi><mn>4</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_3(t) - N_4(t)</annotation></semantics></math>.
The mid price process is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>N</mi><mn>3</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>N</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>N</mi><mn>4</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(t) = N_1(t) + N_3(t) - N_2(t) - N_4(t)</annotation></semantics></math>
plus initial mid price level.</p>
<p>The base intensity process is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>ζ</mi><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>ζ</mi><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>1</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mu = \begin{bmatrix} \mu_1 \\ \zeta \ell(t-) \\ \zeta \ell(t-) \\ \mu_1 \end{bmatrix}, \quad \ell(t) = \frac{L(t)}{p(t)} </annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>⋯</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">L(t) \in \{ 0, 1, 2, \cdots \}</annotation></semantics></math>
is the absolute level of the bid-ask spread with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">L(t)=0</annotation></semantics></math>
implying the minimum level. For details, see <a href="https://academic.oup.com/jfec/article/21/4/1099/6513935?login=true" class="external-link">Modeling
bid and ask price dynamics with an extended Hawkes process and its
empirical applications for high-frequency stock market data</a>.</p>
<p>Note that in the following code of the definition of <code>mu</code>,
<code>n</code> is needed to represent time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and <code>Nc</code> is needed to calculate the level and mid price.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># presumed initial bid and ask prices</span></span>
<span><span class="va">initial_ask_price</span> <span class="op">&lt;-</span> <span class="fl">1250</span> <span class="co">#cents</span></span>
<span><span class="va">initial_bid_price</span> <span class="op">&lt;-</span> <span class="fl">1150</span> <span class="co">#cents</span></span>
<span></span>
<span><span class="va">initial_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">initial_ask_price</span> <span class="op">-</span> <span class="va">initial_bid_price</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">initial_mid_price</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">initial_bid_price</span> <span class="op">+</span> <span class="va">initial_ask_price</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mu1 <span class="op">=</span> <span class="fl">0.08</span>, zeta1 <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span>, <span class="va">n</span><span class="op">=</span><span class="va">n</span>, <span class="va">Nc</span><span class="op">=</span><span class="va">Nc</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">level</span> <span class="op">&lt;-</span> <span class="va">initial_level</span></span>
<span>    <span class="va">mid</span> <span class="op">&lt;-</span> <span class="va">initial_mid_price</span></span>
<span>    </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">level</span> <span class="op">&lt;-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">initial_level</span></span>
<span>    <span class="va">ask</span> <span class="op">&lt;-</span> <span class="va">initial_ask_price</span> <span class="op">+</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> </span>
<span>    <span class="va">bid</span> <span class="op">&lt;-</span> <span class="va">initial_bid_price</span> <span class="op">+</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span> </span>
<span>    <span class="va">mid</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ask</span> <span class="op">+</span> <span class="va">bid</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">level</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"mu1"</span><span class="op">]</span>, <span class="fl">0</span>,</span>
<span>             <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">"mu1"</span><span class="op">]</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"mu1"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"zeta1"</span><span class="op">]</span> <span class="op">*</span> <span class="va">level</span> <span class="op">/</span> <span class="va">mid</span>,</span>
<span>             <span class="va">param</span><span class="op">[</span><span class="st">"zeta1"</span><span class="op">]</span><span class="op">*</span><span class="va">level</span> <span class="op">/</span> <span class="va">mid</span>, <span class="va">param</span><span class="op">[</span><span class="st">"mu1"</span><span class="op">]</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In addition, the kernel is represented by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>s</mi><mn>1</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mi>m</mi></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>s</mi><mn>2</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>w</mi><mn>1</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>n</mi><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>n</mi><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>w</mi><mn>2</mn></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>w</mi><mn>2</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>n</mi><mn>2</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>n</mi><mn>2</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>w</mi><mn>1</mn></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>s</mi><mn>2</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mi>m</mi></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>α</mi><mrow><mi>s</mi><mn>1</mn></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">h(t, u) = 
\begin{bmatrix} \alpha_{s1} &amp; \alpha_{m} &amp; \alpha_{s2} &amp; 0 \\   \alpha_{w1} &amp; \alpha_{n1}(u) &amp; \alpha_{n1}(u) &amp; \alpha_{w2} \\  \alpha_{w2} &amp; \alpha_{n2}(u) &amp; \alpha_{n2}(u) &amp; \alpha_{w1} \\  0 &amp; \alpha_{s2} &amp; \alpha_{m} &amp; \alpha_{s1} \\   \end{bmatrix},
</annotation></semantics></math></p>
<p>where</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mrow><mi>n</mi><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mn>4</mn></munderover><msub><mi>λ</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>ξ</mi><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>α</mi><mrow><mi>n</mi><mn>2</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mn>4</mn></munderover><msub><mi>λ</mi><mrow><mn>3</mn><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>ξ</mi><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\alpha_{n1}(u) = - \sum_{j=1}^4 \lambda_{2j}(u) + \xi \ell(u), \quad \alpha_{n2}(u) = - \sum_{j=1}^4 \lambda_{3j}(u) + \xi \ell(u),
</annotation></semantics></math></p>
<p>for constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\xi \geq 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{ij}</annotation></semantics></math>
is a component of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math>
such that</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mrow><mo>−</mo><mi>∞</mi></mrow><mi>t</mi></msubsup><msub><mi>h</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><msub><mi>N</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\lambda_{ij}(t) = \int_{-\infty}^t h_{ij}(t, u) d N_j(u).</annotation></semantics></math></p>
<p>In the following code, we separate the constant part of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
as <code>alpha</code> and stochastic part as <code>impact</code>. To
represent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{ij}</annotation></semantics></math>,
we need <code>lambda_component</code>. Note that</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>alpha_s1<span class="op">=</span><span class="fl">4</span>, alpha_m<span class="op">=</span><span class="fl">26</span>, alpha_s2<span class="op">=</span><span class="fl">5</span>,</span>
<span>                            alpha_w1<span class="op">=</span><span class="fl">11</span>, alpha_w2<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">param</span><span class="op">[</span><span class="st">"alpha_s1"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_m"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_s2"</span><span class="op">]</span>, <span class="fl">0</span>,</span>
<span>           <span class="va">param</span><span class="op">[</span><span class="st">"alpha_w1"</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_w2"</span><span class="op">]</span>,</span>
<span>           <span class="va">param</span><span class="op">[</span><span class="st">"alpha_w2"</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_w1"</span><span class="op">]</span>,</span>
<span>           <span class="fl">0</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_s2"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_m"</span><span class="op">]</span>, <span class="va">param</span><span class="op">[</span><span class="st">"alpha_s1"</span><span class="op">]</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">impact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xi <span class="op">=</span> <span class="fl">2.7</span><span class="op">)</span>, <span class="va">n</span><span class="op">=</span><span class="va">n</span>, <span class="va">Nc</span><span class="op">=</span><span class="va">Nc</span>, <span class="va">lambda_component</span> <span class="op">=</span> <span class="va">lambda_component</span>, <span class="va">...</span> <span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">level</span> <span class="op">&lt;-</span>  <span class="va">initial_level</span></span>
<span>    <span class="co"># mid &lt;- initial_mid_price</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">level</span> <span class="op">&lt;-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">initial_level</span></span>
<span>    <span class="va">ask</span> <span class="op">&lt;-</span> <span class="va">initial_ask_price</span> <span class="op">+</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">bid</span> <span class="op">&lt;-</span> <span class="va">initial_bid_price</span> <span class="op">+</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">mid</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ask</span> <span class="op">+</span> <span class="va">bid</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">lambda_component_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">lambda_component</span><span class="op">[</span><span class="va">n</span>, <span class="op">]</span>, nrow<span class="op">=</span><span class="fl">4</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lambda_component_matrix</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># sum of second row</span></span>
<span>  <span class="va">l3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lambda_component_matrix</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># sum of third row</span></span>
<span></span>
<span>  <span class="va">im</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                 <span class="fl">0</span>, <span class="op">-</span><span class="va">l2</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"xi"</span><span class="op">]</span><span class="op">*</span><span class="va">level</span><span class="op">/</span><span class="va">mid</span>, <span class="op">-</span><span class="va">l2</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"xi"</span><span class="op">]</span><span class="op">*</span><span class="va">level</span><span class="op">/</span><span class="va">mid</span>, <span class="fl">0</span>,</span>
<span>                 <span class="fl">0</span>, <span class="op">-</span><span class="va">l3</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"xi"</span><span class="op">]</span><span class="op">*</span><span class="va">level</span><span class="op">/</span><span class="va">mid</span>, <span class="op">-</span><span class="va">l3</span> <span class="op">+</span> <span class="va">param</span><span class="op">[</span><span class="st">"xi"</span><span class="op">]</span><span class="op">*</span><span class="va">level</span><span class="op">/</span><span class="va">mid</span>, <span class="fl">0</span>,</span>
<span>                 <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">16</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rmark</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">=</span><span class="va">n</span>, <span class="va">Nc</span><span class="op">=</span><span class="va">Nc</span>, <span class="va">type</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">level</span> <span class="op">&lt;-</span>  <span class="va">initial_level</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">level</span> <span class="op">&lt;-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">Nc</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">initial_level</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">type</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">|</span> <span class="va">type</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">level</span>,  <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">rgeom</a></span><span class="op">(</span><span class="fl">1</span>, p<span class="op">=</span><span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html" class="external-link">rgeom</a></span><span class="op">(</span><span class="fl">1</span>, p<span class="op">=</span><span class="fl">0.65</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">h_ba</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu <span class="op">=</span> <span class="va">mu</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, impact<span class="op">=</span><span class="va">impact</span>, rmark <span class="op">=</span> <span class="va">rmark</span><span class="op">)</span></span>
<span><span class="va">h_ba</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 4-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt; function (param = c(mu1 = 0.08, zeta1 = 0.1), n = n, Nc = Nc, </span></span>
<span><span class="co">#&gt;     ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (n == 1) {</span></span>
<span><span class="co">#&gt;         level &lt;- initial_level</span></span>
<span><span class="co">#&gt;         mid &lt;- initial_mid_price</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         level &lt;- Nc[n - 1, 1] - Nc[n - 1, 2] - (Nc[n - 1, 3] - </span></span>
<span><span class="co">#&gt;             Nc[n - 1, 4]) + initial_level</span></span>
<span><span class="co">#&gt;         ask &lt;- initial_ask_price + (Nc[n - 1, 1] - Nc[n - 1, </span></span>
<span><span class="co">#&gt;             2])</span></span>
<span><span class="co">#&gt;         bid &lt;- initial_bid_price + (Nc[n - 1, 3] - Nc[n - 1, </span></span>
<span><span class="co">#&gt;             4])</span></span>
<span><span class="co">#&gt;         mid &lt;- (ask + bid)/2</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if (level &lt;= 0) {</span></span>
<span><span class="co">#&gt;         matrix(c(param["mu1"], 0, 0, param["mu1"]), nrow = 4)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         matrix(c(param["mu1"], param["zeta1"] * level/mid, param["zeta1"] * </span></span>
<span><span class="co">#&gt;             level/mid, param["mu1"]), nrow = 4)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt; function (param = c(alpha_s1 = 4, alpha_m = 26, alpha_s2 = 5, </span></span>
<span><span class="co">#&gt;     alpha_w1 = 11, alpha_w2 = 7)) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     matrix(c(param["alpha_s1"], param["alpha_m"], param["alpha_s2"], </span></span>
<span><span class="co">#&gt;         0, param["alpha_w1"], 0, 0, param["alpha_w2"], param["alpha_w2"], </span></span>
<span><span class="co">#&gt;         0, 0, param["alpha_w1"], 0, param["alpha_s2"], param["alpha_m"], </span></span>
<span><span class="co">#&gt;         param["alpha_s1"]), nrow = 4, byrow = TRUE)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x557df34ac2e8&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]   50   50   50   50</span></span>
<span><span class="co">#&gt; [2,]   50   50   50   50</span></span>
<span><span class="co">#&gt; [3,]   50   50   50   50</span></span>
<span><span class="co">#&gt; [4,]   50   50   50   50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot impact: </span></span>
<span><span class="co">#&gt; function (param = c(xi = 2.7), n = n, Nc = Nc, lambda_component = lambda_component, </span></span>
<span><span class="co">#&gt;     ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (n == 1) {</span></span>
<span><span class="co">#&gt;         level &lt;- initial_level</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         level &lt;- Nc[n, 1] - Nc[n, 2] - (Nc[n, 3] - Nc[n, 4]) + </span></span>
<span><span class="co">#&gt;             initial_level</span></span>
<span><span class="co">#&gt;         ask &lt;- initial_ask_price + (Nc[n, 1] - Nc[n, 2])</span></span>
<span><span class="co">#&gt;         bid &lt;- initial_bid_price + (Nc[n, 3] - Nc[n, 4])</span></span>
<span><span class="co">#&gt;         mid &lt;- (ask + bid)/2</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     lambda_component_matrix &lt;- matrix(lambda_component[n, ], </span></span>
<span><span class="co">#&gt;         nrow = 4, byrow = TRUE)</span></span>
<span><span class="co">#&gt;     l2 &lt;- sum(lambda_component_matrix[2, ])</span></span>
<span><span class="co">#&gt;     l3 &lt;- sum(lambda_component_matrix[3, ])</span></span>
<span><span class="co">#&gt;     im &lt;- matrix(c(0, 0, 0, 0, 0, -l2 + param["xi"] * level/mid, </span></span>
<span><span class="co">#&gt;         -l2 + param["xi"] * level/mid, 0, 0, -l3 + param["xi"] * </span></span>
<span><span class="co">#&gt;             level/mid, -l3 + param["xi"] * level/mid, 0, 0, 0, </span></span>
<span><span class="co">#&gt;         0, 0), nrow = 4, byrow = TRUE)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot rmark: </span></span>
<span><span class="co">#&gt; function (n = n, Nc = Nc, type, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (n == 1) {</span></span>
<span><span class="co">#&gt;         level &lt;- initial_level</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         level &lt;- Nc[n - 1, 1] - Nc[n - 1, 2] - (Nc[n - 1, 3] - </span></span>
<span><span class="co">#&gt;             Nc[n - 1, 4]) + initial_level</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if (type[n] == 2 | type[n] == 3) {</span></span>
<span><span class="co">#&gt;         min(level, rgeom(1, p = 0.65) + 1)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         rgeom(1, p = 0.65) + 1</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">hr_ba</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">h_ba</span>, size<span class="op">=</span><span class="fl">1000</span>, lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hr_ba</span><span class="op">)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; Simulation result of exponential (marked) Hawkes model.</span></span>
<span><span class="co">#&gt; Realized path :</span></span>
<span><span class="co">#&gt;       arrival N1 N2 N3 N4 mark lambda1    lambda2   lambda3 lambda4</span></span>
<span><span class="co">#&gt;  [1,]  0.0000  0  0  0  0    0 4.08000  4.0082500 4.0082500  4.0800</span></span>
<span><span class="co">#&gt;  [2,]  3.6673  1  0  0  0    2 0.08000  0.0082500 0.0082500  0.0800</span></span>
<span><span class="co">#&gt;  [3,]  6.9225  2  0  0  0    1 0.08000  0.0084097 0.0084097  0.0800</span></span>
<span><span class="co">#&gt;  [4,] 20.0251  2  0  0  1    1 0.08000  0.0084894 0.0084894  0.0800</span></span>
<span><span class="co">#&gt;  [5,] 24.3957  2  0  0  2    3 0.08000  0.0085762 0.0085762  0.0800</span></span>
<span><span class="co">#&gt;  [6,] 24.4026  2  0  1  2    1 0.08000  4.9856950 7.8296138  2.9239</span></span>
<span><span class="co">#&gt;  [7,] 27.9067  3  0  1  2    1 0.08000  0.0087500 0.0087500  0.0800</span></span>
<span><span class="co">#&gt;  [8,] 27.9378  3  1  1  2    1 0.92442  2.3309869 1.4865661  0.0800</span></span>
<span><span class="co">#&gt;  [9,] 33.8868  3  1  2  2    2 0.08000  0.0087500 0.0087500  0.0800</span></span>
<span><span class="co">#&gt; [10,] 33.8900  3  1  2  3    1 4.33027  0.2054120 0.2054120 22.1814</span></span>
<span><span class="co">#&gt; [11,] 34.3764  4  1  2  3    1 0.08000  0.0086631 0.0086631  0.0800</span></span>
<span><span class="co">#&gt; [12,] 34.4342  4  2  2  3    1 0.30328  0.6227650 0.3994842  0.0800</span></span>
<span><span class="co">#&gt; [13,] 36.5641  5  2  2  3    2 0.08000  0.0086631 0.0086631  0.0800</span></span>
<span><span class="co">#&gt; [14,] 36.5658  5  3  2  3    2 3.74917 10.0990280 6.4298623  0.0800</span></span>
<span><span class="co">#&gt; [15,] 40.4590  5  3  2  4    1 0.08000  0.0086631 0.0086631  0.0800</span></span>
<span><span class="co">#&gt; [16,] 40.4666  5  3  3  4    1 0.08000  4.8059475 7.5472032  2.8213</span></span>
<span><span class="co">#&gt; [17,] 43.8835  6  3  3  4    5 0.08000  0.0086631 0.0086631  0.0800</span></span>
<span><span class="co">#&gt; [18,] 44.8818  7  3  3  4    2 0.08000  0.0090607 0.0090607  0.0800</span></span>
<span><span class="co">#&gt; [19,] 47.6976  7  3  3  5    2 0.08000  0.0092193 0.0092193  0.0800</span></span>
<span><span class="co">#&gt; [20,] 51.7138  8  3  3  5    1 0.08000  0.0093932 0.0093932  0.0800</span></span>
<span><span class="co">#&gt; ... with 980 more rows </span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span></code></pre></div>
<p>As a separate log-likelihood estimation performed, the parameter for
mark distribution is not estimated.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">h_ba</span>, inter_arrival <span class="op">=</span> <span class="va">hr_ba</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">hr_ba</span><span class="op">$</span><span class="va">type</span>, Nc <span class="op">=</span> <span class="va">hr_ba</span><span class="op">$</span><span class="va">Nc</span>,</span>
<span>       lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; loglikelihood </span></span>
<span><span class="co">#&gt;     -1817.794</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_ba</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">h_ba</span>, inter_arrival <span class="op">=</span> <span class="va">hr_ba</span><span class="op">$</span><span class="va">inter_arrival</span>, type <span class="op">=</span> <span class="va">hr_ba</span><span class="op">$</span><span class="va">type</span>,</span>
<span>               lambda_component0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle_ba</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 37 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -1810.43 </span></span>
<span><span class="co">#&gt; 9  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;           Estimate Std. error t value  Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1       0.069541   0.003583  19.407  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; zeta1     0.135214   0.010696  12.641  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha_s1  4.656127   1.091747   4.265    2e-05 ***</span></span>
<span><span class="co">#&gt; alpha_m  23.554240        NaN     NaN      NaN    </span></span>
<span><span class="co">#&gt; alpha_s2  5.849631   6.305055   0.928 0.353528    </span></span>
<span><span class="co">#&gt; alpha_w1 10.283690   2.860066   3.596 0.000324 ***</span></span>
<span><span class="co">#&gt; alpha_w2  7.402715   2.299566   3.219 0.001286 ** </span></span>
<span><span class="co">#&gt; beta1.1  51.868593   3.094326  16.762  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; xi        2.376550        NaN     NaN      NaN    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="point-process-with-flexible-residual">Point process with flexible residual<a class="anchor" aria-label="anchor" href="#point-process-with-flexible-residual"></a>
</h2>
<div class="section level3">
<h3 id="one-dimensional-model">One-dimensional model<a class="anchor" aria-label="anchor" href="#one-dimensional-model"></a>
</h3>
<p>This code demonstrates how to create a point process with a flexible
residual structure. For details, see <a href="https://link.springer.com/article/10.1007/s11009-025-10159-5" class="external-link">Self
and mutually exciting point process embedding flexible residuals and
intensity with discretely Markovian dynamics</a>. The distribution used
in this example is a combination of a trapezoid and an exponential
distribution. The <code>dresidual</code> and <code>presidual</code>
functions receive their necessary parameters bundled into a param
vector. In the context of a Hawkes process model, these functions
correspond to the case where the residuals are unit exponential
distributions.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu1_d</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>; <span class="va">alpha1_d</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta1_d</span> <span class="op">&lt;-</span> <span class="fl">1.2</span>; <span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>; <span class="va">ell</span> <span class="op">&lt;-</span> <span class="fl">1.6</span></span>
<span><span class="va">hspec1_d</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu1_d</span>, alpha<span class="op">=</span><span class="va">alpha1_d</span>, beta<span class="op">=</span><span class="va">beta1_d</span>,</span>
<span>              rresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="fu"><a href="../reference/tzexp.html">rtzexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">size</span>, a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span>,</span>
<span>              dresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="fu"><a href="../reference/tzexp.html">dtzexp</a></span><span class="op">(</span><span class="va">x</span>, a <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span>, ell <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"ell"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              presidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">q</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="fu"><a href="../reference/tzexp.html">ptzexp</a></span><span class="op">(</span><span class="va">q</span>, a <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span>, ell <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"ell"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              qresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="fu"><a href="../reference/tzexp.html">qtzexp</a></span><span class="op">(</span><span class="va">p</span>, a <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span>, ell <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"ell"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dh1_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec1_d</span>, size <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">dh1_real</span><span class="op">$</span><span class="va">inter_arrival</span><span class="op">[</span><span class="va">dh1_real</span><span class="op">$</span><span class="va">inter_arrival</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inter-Arrival Times"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Inter-Arrival Time"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-57-1.png" width="576"></p>
<p>This R code snippet demonstrates how to analyze the residual process
of a point process model using a flexible distribution. The logLik
function is used to compute the log-likelihood of observed inter-arrival
times (<code>dh1_real$inter_arrival</code>) based on the distribution
specified by <code>hspec1_d</code>. The <code>infer = TRUE</code>
parameter allows the function to also infer the residual process,
storing the results in <code>infer_res_dh1</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Infer the residual process using the log-likelihood method</span></span>
<span><span class="co"># 'infer_res_dh1' contains the inferred process data based on the inter-arrival times</span></span>
<span><span class="va">infer_res_dh1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hspec1_d</span>, inter_arrival <span class="op">=</span> <span class="va">dh1_real</span><span class="op">$</span><span class="va">inter_arrival</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot a histogram of the inferred residual process</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">infer_res_dh1</span><span class="op">$</span><span class="va">res_process1</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inferred Residual Process"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Residual Value"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Density"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu"><a href="../reference/tzexp.html">dtzexp</a></span><span class="op">(</span><span class="va">x</span>, a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend for clarity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="st">"Theoretical PDF"</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-58-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="two-dimenional-model">Two-dimenional model<a class="anchor" aria-label="anchor" href="#two-dimenional-model"></a>
</h3>
<p>The above method can be extended to multi-dimensions. The basic
approach to extension is similar to how multi-dimensional Hawkes models
are handled.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu2_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha2_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta2_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>; <span class="va">ell</span> <span class="op">&lt;-</span> <span class="fl">1.6</span></span>
<span></span>
<span><span class="va">hspec2_du</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu2_d</span>, alpha<span class="op">=</span><span class="va">alpha2_d</span>, beta<span class="op">=</span><span class="va">beta2_d</span>,</span>
<span>              rresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="fu"><a href="../reference/tzexp.html">rtzexp</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">size</span>, a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span>,</span>
<span>              dresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="fu"><a href="../reference/tzexp.html">dtzexp</a></span><span class="op">(</span><span class="va">x</span>, a <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span>, ell <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"ell"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              presidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">q</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="fu"><a href="../reference/tzexp.html">ptzexp</a></span><span class="op">(</span><span class="va">q</span>, a <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span>, ell <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"ell"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              qresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="fu"><a href="../reference/tzexp.html">qtzexp</a></span><span class="op">(</span><span class="va">p</span>, a <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span>, ell <span class="op">=</span> <span class="va">param</span><span class="op">[</span><span class="st">"ell"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hspec2_du</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class "hspec" of 2-dimensional Hawkes process</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot mu: </span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]  0.3</span></span>
<span><span class="co">#&gt; [2,]  0.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot alpha: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.5  0.8</span></span>
<span><span class="co">#&gt; [2,]  0.8  0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot beta: </span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.5  1.5</span></span>
<span><span class="co">#&gt; [2,]  1.5  1.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot rresidual: </span></span>
<span><span class="co">#&gt; function (size) </span></span>
<span><span class="co">#&gt; rtzexp(n = size, a = a, ell = ell)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot dresidual: </span></span>
<span><span class="co">#&gt; function (x, param = c(a = a, ell = ell)) </span></span>
<span><span class="co">#&gt; dtzexp(x, a = param["a"], ell = param["ell"])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot presidual: </span></span>
<span><span class="co">#&gt; function (q, param = c(a = a, ell = ell)) </span></span>
<span><span class="co">#&gt; ptzexp(q, a = param["a"], ell = param["ell"])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slot qresidual: </span></span>
<span><span class="co">#&gt; function (p, param = c(a = a, ell = ell)) </span></span>
<span><span class="co">#&gt; qtzexp(p, a = param["a"], ell = param["ell"])</span></span></code></pre></div>
<p>Histogram of inter-arrival times under <code>tzexp</code>
distribution.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1107</span><span class="op">)</span></span>
<span><span class="va">duh2_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec2_du</span>, size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co"># Plot a histogram of the inter-arrival times less than 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">duh2_real</span><span class="op">$</span><span class="va">inter_arrival</span><span class="op">[</span><span class="va">duh2_real</span><span class="op">$</span><span class="va">inter_arrival</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">]</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inter-Arrival Times"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Inter-Arrival Time"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-60-1.png" width="576"></p>
<p>Inference based on the flexible residual model.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infer_res_dh2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hspec2_du</span>, </span>
<span>                        inter_arrival <span class="op">=</span> <span class="va">duh2_real</span><span class="op">$</span><span class="va">inter_arrival</span>, </span>
<span>                        type <span class="op">=</span> <span class="va">duh2_real</span><span class="op">$</span><span class="va">type</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The residual process follows the residual distribution in the
model.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot a histogram of the inferred residual process</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">infer_res_dh2</span><span class="op">$</span><span class="va">res_process2</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inferred Residual Process"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Residual Value"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Density"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate a sequence of x values for plotting the theoretical distribution</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a line to the histogram representing the theoretical density function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu"><a href="../reference/tzexp.html">dtzexp</a></span><span class="op">(</span><span class="va">x</span>, a <span class="op">=</span> <span class="va">a</span>, ell <span class="op">=</span> <span class="va">ell</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend for clarity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="st">"Theoretical PDF"</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-62-1.png" width="576"></p>
<p>The <code>eres_process</code> follows the exponential
distribution.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">infer_res_dh2</span><span class="op">$</span><span class="va">eres_process1</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inferred eResidual Process"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Residual Value"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Density"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate a sequence of x values for plotting the theoretical distribution</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a line to the histogram representing the theoretical density function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend for clarity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="st">"Theoretical PDF"</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-63-1.png" width="576"></p>
<p>The maximum likelihood estimation.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_dh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hfit.html">hfit</a></span><span class="op">(</span><span class="va">hspec2_du</span>, </span>
<span>               inter_arrival <span class="op">=</span> <span class="va">duh2_real</span><span class="op">$</span><span class="va">inter_arrival</span>, </span>
<span>               type <span class="op">=</span> <span class="va">duh2_real</span><span class="op">$</span><span class="va">type</span>,</span>
<span>               constraint<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ineqA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span>, ineqB<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle_dh</span><span class="op">)</span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span>
<span><span class="co">#&gt; Maximum Likelihood estimation</span></span>
<span><span class="co">#&gt; BFGS maximization, 68 iterations</span></span>
<span><span class="co">#&gt; Return code 0: successful convergence </span></span>
<span><span class="co">#&gt; Log-Likelihood: -12548.98 </span></span>
<span><span class="co">#&gt; 6  free parameters</span></span>
<span><span class="co">#&gt; Estimates:</span></span>
<span><span class="co">#&gt;          Estimate Std. error t value Pr(&gt; t)    </span></span>
<span><span class="co">#&gt; mu1      0.289588   0.009073   31.92  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.1 0.495306   0.022192   22.32  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha1.2 0.813851   0.024297   33.50  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; beta1.1  1.505598   0.046827   32.15  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; a        0.692895        NaN     NaN     NaN    </span></span>
<span><span class="co">#&gt; ell      1.584268        NaN     NaN     NaN    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Warning: constrained likelihood estimation. Inference is probably wrong</span></span>
<span><span class="co">#&gt; Constrained optimization based on constrOptim </span></span>
<span><span class="co">#&gt; 1  outer iterations, barrier value -0.00051762 </span></span>
<span><span class="co">#&gt; --------------------------------------------</span></span></code></pre></div>
<p>Uniform residual distribution example is also provided.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#set.seed(117)</span></span>
<span><span class="va">mu2_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">alpha2_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta2_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hspec2_du</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"hspec"</span>, mu<span class="op">=</span><span class="va">mu2_d</span>, alpha<span class="op">=</span><span class="va">alpha2_d</span>, beta<span class="op">=</span><span class="va">beta2_d</span>,</span>
<span>                 rresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">size</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                 dresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                 presidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">q</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">punif</a></span><span class="op">(</span><span class="va">q</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                 qresidual <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">param</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">qunif</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">duh2_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsim.html">hsim</a></span><span class="op">(</span><span class="va">hspec2_du</span>, size <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
<p>Histogram of the residual process:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">infer_res_duh2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">hspec2_du</span>, </span>
<span>                         inter_arrival <span class="op">=</span> <span class="va">duh2_real</span><span class="op">$</span><span class="va">inter_arrival</span>, </span>
<span>                         type <span class="op">=</span> <span class="va">duh2_real</span><span class="op">$</span><span class="va">type</span>, infer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">infer_res_duh2</span><span class="op">$</span><span class="va">res_process1</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Histogram of Inferred Residual Process"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Residual Value"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Density"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="extended_example_files/figure-html/unnamed-chunk-66-1.png" width="576"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyungsub Lee.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
